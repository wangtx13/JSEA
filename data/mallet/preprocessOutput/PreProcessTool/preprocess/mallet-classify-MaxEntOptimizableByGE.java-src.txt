2011 m a l l e t m achine languag e ~mccallum 1 0 further ` l i e n s e classify list arrays logging logger classify constraints ge max ent g e constraint optimize optimizable types feature vector types instance types instance list types matrix ops progress message logger training max ent models labeled features using generalized expectation criteria based on from labeled features using generalized expectation criteria gregory druck gideon mann andrew mc callum s i g i r 2008 author gregory druck <a href= mailto gdruck >gdruck edu< a> author gdruck max ent optimizable g e optimizable gradient value logger progress logger = progress message logger get logger max ent optimizable g e get name + pl cache stale = feature index temperature obj weight cached value gaussian prior variance cached gradient instance list training list max ent classifier list< max ent g e constraint> constraints training list list unlabeled training instances constraints feature expectation constraints init classifier initial classifier max ent optimizable g e instance list training list list< max ent g e constraint> constraints max ent init classifier temperature = 1 0 obj weight = 1 0 gaussian prior variance = 1 0 training list = training list num features = training list get data alphabet size feature index = num features num labels = training list get target alphabet size cached gradient = num features + 1 num labels cached value = 0 init classifier != = init classifier classifier = init classifier = num features + 1 num labels classifier = max ent training list get pipe constraints = constraints max ent g e constraint constraint constraints constraint pre process training list sets variance gaussian prior or equivalently inverse weight l2 regularization term variance gaussian prior variance set gaussian prior variance variance gaussian prior variance = variance model probabilities are raised to power 1 temperature and renormalized temperature decreases model probabilities approach 1 maximum probability and 0 other classes d e f a u l t 1 temp temperature set temperature temp temperature = temp weight g e term in objective function weight g e term weight set weight weight obj weight = weight max ent get classifier classifier get value !cache stale cached value obj weight == 0 0 0 max ent g e constraint constraint constraints constraint zero expectations arrays fill cached gradient 0 num features = training list get data alphabet size + 1 num labels = training list get target alphabet size scores = training list size num labels constraint value = num labels pass 1 calculate model ii = 0 ii < training list size ii++ instance instance = training list get ii instance weight = training list get instance weight instance skip labeled instance get target != feature vector fv = feature vector instance get data classifier get classification scores temperature instance temperature scores ii max ent g e constraint constraint constraints constraint compute expectations fv scores ii instance weight compute value value = 0 max ent g e constraint constraint constraints value += constraint get value value = obj weight pass 2 determine per example gradient ii = 0 ii < training list size ii++ instance instance = training list get ii skip labeled instance get target != arrays fill constraint value 0 instance expectation = 0 instance weight = training list get instance weight instance feature vector fv = feature vector instance get data max ent g e constraint constraint constraints constraint pre process fv label = 0 label < num labels label++ val = constraint get composite constraint feature value fv label constraint value label += val instance expectation += val scores ii label label = 0 label < num labels label++ scores ii label == 0 ! infinite scores ii label weight = obj weight instance weight scores ii label constraint value label instance expectation temperature ! na n weight matrix ops row plus equals cached gradient num features label fv weight cached gradient num features label + feature index += weight cached value = value cache stale = reg = get regularization progress logger info value g e= + value + gaussian prior= + reg + = + cached value cached value get regularization regularization = 0 pi = 0 pi < length pi++ p = pi regularization = p p 2 gaussian prior variance cached gradient pi = p gaussian prior variance cached value += regularization regularization get value gradient buffer cache stale get value buffer length == cached gradient length arraycopy cached gradient 0 buffer 0 buffer length get num length get parameter index index get buffer buffer length == length arraycopy 0 buffer 0 buffer length set parameter index value cache stale = index = value set params params length == length cache stale = arraycopy params 0 0 length 