io regex replacement serializable target tokens input contains two sections separated a tab target second field all whitespace replaced underscores input a single field target input all whitespace replace underscores replacement line fields = line split tokens = fields 0 split fields length == 2 target = fields 1 replace all \\s+ fields length == 1 target = fields 0 replace all \\s+ normally we not allow tokens that start numbers user has specifically requested a replacement that starts a number escape it an underscore character get type target point at 0 == character d e i m a l d i g i t n u m b e r target = + target a that specifies a target which may be an empty replacement source target tokens = source split target = target apply input start position builder output start at second token since we assume that first token matches replacement being matched i=1 i < tokens length i++ start position + i >= input length start position ! input start position + i equals tokens i start position we ve matched all tokens in source so modify input to notify preprocessor replacement output target and advance position input start position = target output append target + start position + tokens length get first token tokens 0 serial u = 1 u r r e n t s e r i a l v e r s i o n = 1 write output stream out i o out write u r r e n t s e r i a l v e r s i o n out write target out write tokens read input stream in i o not found = in read target = in read tokens = in read 