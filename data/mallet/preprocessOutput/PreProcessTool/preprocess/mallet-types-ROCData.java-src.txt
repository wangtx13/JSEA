2002 m a l l e t m achine languag e ~mccallum 1 0 further ` l i e n s e types io serializable text decimal format text number format arrays classify classification classify classifier classify trial types alphabet types alphabet carrying types instance list types label types label alphabet types label vector tracks r o data instances in link trial results trial instance list classifier classification author michael bond <a href= mailto mikejbond gmail com >mikejbond gmail com< a> r o data alphabet carrying serializable serial u = 2060194953037720640 l t r u e p o s i t i v e = 0 f a l s e p o s i t i v e = 1 f a l s e n e g a t i v e = 2 t r u e n e g a t i v e = 3 label alphabet label alphabet matrix threshold tp fp fn tn counts thresholds constructs a thresholds thresholds to track counts label alphabet label alphabet instances in link trial r o data thresholds label alphabet label alphabet ensure that thresholds are sorted arrays sort thresholds counts = label alphabet size thresholds length 4 label alphabet = label alphabet thresholds = thresholds adds classification results to r o data trial trial results to add to r o data add classification classification correct index = classification get instance get labeling get best index label vector lv = classification get label vector values = lv get values ! alphabet alphabets match lv illegal argument alphabets not match num labels = label alphabet size label = 0 label < num labels label++ label value = values label threshold counts = counts label threshold = 0 add trial to all thresholds it would be positive threshold < thresholds length label value >= thresholds threshold threshold++ correct index == label threshold counts threshold t r u e p o s i t i v e ++ threshold counts threshold f a l s e p o s i t i v e ++ add trial to thresholds it would be negative threshold < thresholds length threshold++ correct index == label threshold counts threshold f a l s e n e g a t i v e ++ threshold counts threshold t r u e n e g a t i v e ++ adds trial results to r o data trial trial results to add to r o data add trial trial classification classification trial add classification adds existing r o data to r o data roc data r o data to add add r o data roc data ! alphabet alphabets match roc data illegal argument alphabets not match ! arrays equals thresholds roc data thresholds illegal argument thresholds not match counts length = counts length = 0 < counts length c++ counts = counts other counts = roc data counts length = counts length t = 0 t < length t++ thr counts = counts t other thr counts = other counts t thr length = thr counts length s = 0 s < thr length s++ thr counts s += other thr counts s override alphabet get alphabet label alphabet override alphabet get alphabets alphabet label alphabet gets raw counts a specified label label label to get counts # t r u e p o s i t i v e # f a l s e p o s i t i v e # f a l s e n e g a t i v e # t r u e n e g a t i v e raw counts specified label get counts label label counts label get index gets raw counts a specified label and threshold data was not collected exact threshold specified then results highest threshold <= specified threshold will be label label to get counts threshold threshold to get counts # t r u e p o s i t i v e # f a l s e p o s i t i v e # f a l s e n e g a t i v e # t r u e n e g a t i v e raw counts specified label and threshold get counts label label threshold index = arrays binary search thresholds threshold index < 0 index = index 2 counts label get index index gets label alphabet label alphabet get label alphabet label alphabet gets precision a specified label and threshold data was not collected exact threshold specified then results will highest threshold <= specified threshold will be label label to get precision threshold threshold to get precision precision specified label and threshold get precision label label threshold counts = get counts label threshold counts t r u e p o s i t i v e counts t r u e p o s i t i v e + counts f a l s e p o s i t i v e gets precision a specified label and score differs from link r o data get precision label in that it precision only scores falling in one score value not all scores above threshold data was not collected exact threshold specified then results will highest threshold <= specified threshold will be label label to get precision threshold threshold to get precision precision specified label and score get precision score label label score buckets = counts label get index index = arrays binary search thresholds score index < 0 index = index 2 tp fp index == thresholds length 1 tp = buckets index t r u e p o s i t i v e fp = buckets index f a l s e p o s i t i v e tp = buckets index t r u e p o s i t i v e buckets index + 1 t r u e p o s i t i v e fp = buckets index f a l s e p o s i t i v e buckets index + 1 f a l s e p o s i t i v e tp tp + fp gets estimated percentage training events that exceed threshold label label to get precision threshold threshold to get precision estimated percentage events exceeding threshold get positive percent label label threshold counts = get counts label threshold positive = counts t r u e p o s i t i v e + counts f a l s e p o s i t i v e positive positive + counts f a l s e n e g a t i v e + counts t r u e n e g a t i v e 100 0 gets recall rate a specified label and threshold data was not collected exact threshold specified then results will highest threshold <= specified threshold will be label label to get recall threshold threshold to get recall recall rate specified label and threshold get recall label label threshold counts = get counts label threshold counts t r u e p o s i t i v e counts t r u e p o s i t i v e + counts f a l s e n e g a t i v e gets thresholds being tracked thresholds get thresholds thresholds sets raw counts a specified label and threshold data not collected exact threshold specified then counts highest threshold <= specified threshold will be set label label to get counts threshold threshold to get counts counts count values label and threshold # t r u e p o s i t i v e # f a l s e p o s i t i v e # f a l s e n e g a t i v e # t r u e n e g a t i v e set counts label label threshold counts index = arrays binary search thresholds threshold index < 0 index = index 2 old counts = counts label get index index counts length != old counts length illegal argument counts must contain + old counts length + elements i = 0 i < old counts length i++ old counts i = counts i override to builder buf = builder number format format = decimal format 0 #### i = 0 i < label alphabet size i++ label data = counts i buf append r o data buf append label alphabet lookup i to buf append buf append t h r t p f p f n t n precis recall add one row each threshold t = 0 t < thresholds length t++ buf append thresholds t res label data t buf append append res tp = label data t t r u e p o s i t i v e sum = tp + label data t f a l s e p o s i t i v e precision = 0 0 sum != 0 precision = tp sum sum = tp + label data t f a l s e n e g a t i v e recall = 0 0 sum != 0 recall = tp sum buf append append format format precision buf append append format format recall buf append buf append buf to 