2003 m a l l e t m achine languag e ~mccallum 1 0 further ` l i e n s e extract io print stream io output stream io print writer text decimal format iterator types label types label alphabet types matrix ops created oct 8 2004 author < a h r e f= mailto casutton edu>casutton edu< a> $ per field f1 evaluator v 1 1 2007 10 22 21 37 44 exp $ per field f1 evaluator extraction evaluator field comparator comparator = exact match comparator print stream output stream = field comparator get comparator comparator set comparator field comparator comparator comparator = comparator print stream get output stream output stream set output stream output stream output stream output stream = print stream output stream evaluate extraction extraction evaluate extraction out assumes that there are many records documents indexed docs assumes that extractor at most one value evaluate description extraction extraction print stream out num docs = extraction get num documents num docs == extraction get num records label alphabet dict = extraction get label alphabet num labels = dict size num corr = num labels num pred = num labels num = num labels docnum = 0 docnum < num docs docnum++ record extracted = extraction get record docnum record target = extraction get target record docnum calc precision iterator it = extracted fields iterator it has next field pred field = field it next label name = pred field get name field field = target get field name idx = name get index j = 0 j < pred field num values j++ num pred idx ++ field != field value pred field value j comparator num corr idx ++ we have an report necessary should be moved to per field rather than per filler level output stream != xxx t o d o display name supporting document output stream in extraction! output stream predicted +pred field output stream +true field output stream calc it = target fields iterator it has next field field = field it next label name = field get name num name get index += field num values out description+ s e g m e n t counts out name correct pred target i = 0 i < num labels i++ label name = dict lookup label i out name+ +num corr i + +num pred i + +num i out decimal format f = decimal format 0 #### total f1 = 0 total fields = 0 out description+ per field f1 out name p r f1 i = 0 i < num labels i++ p = num pred i == 0 ? 0 num corr i num pred i r = num i == 0 ? 1 num corr i num i f1 = p + r == 0 ? 0 2 p r p + r num pred i > 0 || num i > 0 total f1 += f1 total fields++ label name = dict lookup label i out name+ +f format p + +f format r + +f format f1 total corr = matrix ops sum num corr total pred = matrix ops sum num pred total = matrix ops sum num p = total corr total pred r = total corr total f1 = 2 p r p + r out o v e r a l l micro averaged p= +f format p + r= +f format r + f1= +f format f1 out o v e r a l l macro averaged f1= +f format total f1 total fields out 