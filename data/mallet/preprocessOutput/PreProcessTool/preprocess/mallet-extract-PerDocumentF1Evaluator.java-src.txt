2003 m a l l e t m achine languag e ~mccallum 1 0 further ` l i e n s e extract io print stream io output stream io print writer io output stream writer text decimal format iterator types label types label alphabet types matrix ops created oct 8 2004 author < a h r e f= mailto casutton edu>casutton edu< a> $ per document f1 evaluator v 1 1 2007 10 22 21 37 44 exp $ per document f1 evaluator extraction evaluator field comparator comparator = exact match comparator print stream output stream = field comparator get comparator comparator set comparator field comparator comparator comparator = comparator print stream get output stream output stream set output stream output stream output stream work around bug when wrapping out output stream print stream output stream = print stream output stream output stream = print stream output stream evaluate extraction extraction evaluate extraction out evaluate extraction extraction print stream out evaluate extraction print writer output stream writer out evaluate extraction extraction print writer out evaluate extraction out assumes that there are many records documents indexed docs assumes that extractor at most one value evaluate description extraction extraction print writer out num docs = extraction get num documents num docs == extraction get num records label alphabet dict = extraction get label alphabet num labels = dict size num corr = num labels num pred = num labels num = num labels docnum = 0 docnum < num docs docnum++ record extracted = extraction get record docnum record target = extraction get target record docnum calc precision iterator it = extracted fields iterator it has next field pred field = field it next label name = pred field get name field field = target get field name idx = name get index num pred idx ++ pred field num values > 1 err warning field +pred field+ has more than one extracted value picking arbitrarily field != field value pred field value 0 comparator num corr idx ++ we have an report necessary output stream != xxx t o d o display name supporting document output stream in extraction! document +extraction get document extraction docnum get name output stream predicted +pred field output stream +true field output stream calc it = target fields iterator it has next field field = field it next label name = field get name num name get index ++ decimal format f = decimal format 0 #### total f1 = 0 total fields = 0 out description+ per document f1 out name p r f1 i = 0 i < num labels i++ p = num pred i == 0 ? 0 num corr i num pred i r = num i == 0 ? 1 num corr i num i f1 = p + r == 0 ? 0 2 p r p + r num pred i > 0 || num i > 0 total f1 += f1 total fields++ label name = dict lookup label i out name+ +f format p + +f format r + +f format f1 total corr = matrix ops sum num corr total pred = matrix ops sum num pred total = matrix ops sum num p = total corr total pred r = total corr total f1 = 2 p r p + r out o v e r a l l micro averaged p= +f format p + r= +f format r + f1= +f format f1 out o v e r a l l macro averaged f1= +f format total f1 total fields out 