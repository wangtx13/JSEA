2003 m a l l e t m achine languag e ~mccallum 1 0 further ` l i e n s e extract iterator random list list arrays logging logger io extract extraction extract tokenization filter inference inferencer remember tokenization pipe piped iterator pipe pipe pipe pipe utils pipe iterator pipe input iterator types instance list types instance collection utils utils logger timing created mar 31 2005 author < a h r e f= mailto casutton edu>casutton edu< a> $ a r f extractor trainer v 1 1 2007 10 22 21 38 02 exp $ a r f extractor trainer logger logger = logger get logger a r f extractor trainer get name num iter = 99999 a r f template tmpls instance list training instance list testing iterator< instance> test iterator iterator< instance> train iterator a r f trainer trainer = acrf trainer pipe feature pipe pipe tok pipe a r f evaluator evaluator = acrf trainer log evaluator tokenization filter filter inferencer inferencer inferencer viterbi inferencer num checkpoint iterations = 1 checkpoint directory = use per template train = per template iterations = 100 cache unrolled graphs data subsets random r training pct = 1 testing pct = 1 using cascaded setter idiom a r f extractor trainer set templates a r f template tmpls tmpls = tmpls a r f extractor trainer set data source iterator< instance> train iterator iterator< instance> test iterator train iterator = train iterator test iterator = test iterator a r f extractor trainer set data instance list training instance list testing training = training testing = testing a r f extractor trainer set num iterations num iter num iter = num iter get num iter num iter a r f extractor trainer set pipes pipe tok pipe pipe feature pipe remember tokenization pipe rtp = remember tokenization pipe feature pipe = pipe utils concatenate pipes rtp feature pipe tok pipe = tok pipe a r f extractor trainer set evaluator a r f evaluator evaluator evaluator = evaluator a r f extractor trainer set training a r f trainer acrf trainer trainer = acrf trainer a r f extractor trainer set tokenizatio filter tokenization filter filter filter = filter a r f extractor trainer set cache unrolled graphs cache unrolled graphs cache unrolled graphs = cache unrolled graphs a r f extractor trainer set num checkpoint iterations num checkpoint iterations num checkpoint iterations = num checkpoint iterations a r f extractor trainer set checkpoint directory checkpoint directory checkpoint directory = checkpoint directory a r f extractor trainer set use per template train use per template train use per template train = use per template train a r f extractor trainer set per template iterations num iter per template iterations = num iter a r f trainer get trainer trainer tokenization filter get filter filter a r f extractor train extractor a r f acrf = use per template train ? per template train train acrf a r f extractor extor = a r f extractor acrf tok pipe feature pipe filter != extor set tokenization filter filter extor a r f per template train timing timing = timing has converged = a r f mini acrf = training == setup data ti = 0 ti < tmpls length ti++ a r f template these tmpls = a r f template ti+1 arraycopy tmpls 0 these tmpls 0 these tmpls length logger info per template train round +ti+ templates + collection utils dump to arrays list these tmpls mini acrf = a r f feature pipe these tmpls setup acrf mini acrf a r f evaluator eval = setup evaluator tmpl +ti has converged = trainer train mini acrf training testing eval per template iterations timing tick per template train round +ti finish training to convergence a r f evaluator eval = setup evaluator full !has converged trainer train mini acrf training testing eval num iter last acrf one to go mini acrf trains a a r f given settings subclasses may override to implement alternative training procedures a trained a r f a r f train acrf training == setup data a r f acrf = a r f feature pipe tmpls setup acrf acrf a r f evaluator eval = setup evaluator trainer train acrf training testing eval num iter acrf setup acrf a r f acrf cache unrolled graphs acrf set cache unrolled graphs inferencer != acrf set inferencer inferencer viterbi inferencer != acrf set viterbi inferencer viterbi inferencer a r f evaluator setup evaluator checkpoint prefix a r f evaluator eval = evaluator num checkpoint iterations > 0 list evals = list evals add evaluator evals add checkpointing evaluator checkpoint directory num checkpoint iterations tok pipe feature pipe eval = acrf serial evaluator evals eval setup data timing timing = timing training = instance list feature pipe training add thru pipe piped iterator train iterator tok pipe training pct > 0 training = subset data training training pct test iterator != testing = instance list feature pipe testing add thru pipe piped iterator test iterator tok pipe testing pct > 0 testing = subset data testing training pct timing tick data loading instance list subset data instance list data pct instance list lsts = data split r pct 1 pct lsts 0 instance list get training data training == setup data training instance list get testing data testing == setup data testing extraction extract on test data a r f extractor extor extor extract testing a r f extractor trainer set inferencer inferencer inferencer inferencer = inferencer a r f extractor trainer set viterbi inferencer inferencer viterbi inferencer viterbi inferencer = viterbi inferencer a r f extractor trainer set data subsets random random training pct testing pct r = random training pct = training pct testing pct = testing pct checkpointing checkpointing evaluator a r f evaluator directory interval pipe tok pipe pipe feature pipe checkpointing evaluator directory interval pipe tok pipe pipe feature pipe directory = directory interval = interval tok pipe = tok pipe feature pipe = feature pipe evaluate a r f acrf iter instance list training instance list validation instance list testing iter > 0 iter % interval == 0 a r f extractor extor = a r f extractor acrf tok pipe feature pipe utils write gzipped directory extor +iter+ ser gz extor test instance list gold list description 