2011 m a l l e t m achine languag e ~mccallum 1 0 further ` l i e n s e semi supervised pr constraints gnu trove t list gnu trove t hash map gnu trove t hash map bit set semi supervised state label map types feature vector types feature vector sequence types instance types instance list a set constraints on distributions over single labels conditioned on presence input features to be used p r and penalizes l 2^2 difference from target expectations multiple constraints are grouped together here to make things more efficient author gregory druck one label l2 p r constraints p r constraint maps between input feature indices and constraints t hash map< one label p r constraint> constraints maps between input feature indices and constraint indices t hash map constraint indices state label map map normalized cache set constrained features that fire at last feature vector in preprocess call t list cache one label l2 p r constraints normalized constraints = t hash map< one label p r constraint> constraint indices = t hash map cache = t list normalized = normalized one label l2 p r constraints t hash map< one label p r constraint> constraints t hash map constraint indices state label map map normalized constraints = t hash map< one label p r constraint> key constraints keys constraints put key constraints get key copy constraints = constraints constraint indices = constraint indices map = map cache = t list normalized = normalized p r constraint copy one label l2 p r constraints constraints constraint indices map normalized add constraint fi target weight constraints put fi one label p r constraint target weight constraint indices put fi constraint indices size num dimensions map != map get num labels constraints size one state constraint set state label map state label map map map = map pre process feature vector fv cache reset quick fi cache constrained input features loc = 0 loc < fv num locations loc++ fi = fv index at location loc constraints contains key fi cache add fi find examples that contain constrained input features bit set pre process instance list data count ii = 0 fi feature vector fv bit set bit set = bit set data size instance instance data feature vector sequence fvs = feature vector sequence instance get data ip = 0 ip < fvs size ip++ fv = fvs get ip loc = 0 loc < fv num locations loc++ fi = fv index at location loc constraints contains key fi constraints get fi count += 1 bit set set ii ii++ bit set get score feature vector input input position src index dest index dot = 0 li2 = map get label index dest index i = 0 i < cache size i++ j = constraint indices get cache get quick i t o d o binary features normalized dot += j + constraints size li2 constraints get cache get quick i count dot += j + constraints size li2 dot increment expectations feature vector input input position src index dest index prob li2 = map get label index dest index i = 0 i < cache size i++ constraints get cache get quick i expectation li2 += prob get expectations expectations expectations length == num dimensions fi constraint indices keys ci = constraint indices get fi one label p r constraint constraint = constraints get fi = 0 < constraint expectation length li++ expectations ci + constraints size = constraint expectation add expectations expectations expectations length == num dimensions fi constraint indices keys ci = constraint indices get fi one label p r constraint constraint = constraints get fi = 0 < constraint expectation length li++ constraint expectation += expectations ci + constraints size zero expectations fi constraints keys constraints get fi expectation = map get num labels get auxiliary value contribution value = 0 fi constraints keys ci = constraint indices get fi = 0 < map get num labels li++ = ci + constraints size value += constraints get fi target 2 constraints get fi weight value t o d o get complete value contribution value = 0 fi constraints keys one label p r constraint constraint = constraints get fi = 0 < map get num labels li++ normalized value += constraint weight math pow constraint target constraint expectation constraint count 2 2 value += constraint weight math pow constraint target constraint expectation 2 2 value get gradient gradient fi constraints keys ci = constraint indices get fi one label p r constraint constraint = constraints get fi = 0 < map get num labels li++ normalized gradient ci + constraints size = constraint target constraint expectation constraint count ci + constraints size constraint weight gradient ci + constraints size = constraint target constraint expectation ci + constraints size constraint weight one label p r constraint target expectation count weight one label p r constraint target weight target = target weight = weight expectation = count = 0 one label p r constraint copy one label p r constraint copy = one label p r constraint target weight copy count = count copy expectation = target length copy 