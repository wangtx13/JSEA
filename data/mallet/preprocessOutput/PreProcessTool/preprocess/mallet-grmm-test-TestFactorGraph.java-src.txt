2006 m a l l e t m achine languag e ~mccallum 1 0 further ` l i e n s e test junit framework test junit framework test junit framework test suite io buffered reader io reader io i o hash set iterator list arrays inference random graphs types model reader types matrix ops randoms timing created mar 17 2005 author < a h r e f= mailto casutton edu>casutton edu< a> $ test factor graph v 1 1 2007 10 22 21 37 40 exp $ test factor graph test variable vars table factor tbl1 table factor tbl2 table factor tbl3 log table factor ltbl1 log table factor ltbl2 test factor graph name name set up vars = variable variable 2 variable 2 variable 2 variable 2 tbl1 = table factor variable vars 0 vars 1 0 8 0 1 0 1 0 8 tbl2 = table factor variable vars 1 vars 2 0 2 0 7 0 8 0 2 tbl3 = table factor variable vars 2 vars 3 0 2 0 4 0 6 0 4 ltbl1 = log table factor make from values variable vars 0 vars 1 0 8 0 1 0 1 0 8 ltbl2 = log table factor make from values variable vars 1 vars 2 0 2 0 7 0 8 0 2 test multiply factor graph fg = factor graph fg multiply tbl1 fg multiply tbl2 equals 2 fg factors size fg factors contains tbl1 fg factors contains tbl2 equals 3 fg num variables fg variables set contains vars 0 fg variables set contains vars 1 fg variables set contains vars 2 test num variables factor graph fg = factor graph fg multiply tbl1 fg multiply tbl2 equals 3 fg num variables test multiply factor graph fg = factor graph fg multiply tbl1 fg multiply tbl2 factor graph fg2 = factor graph fg multiply tbl3 equals 2 fg factors size equals 3 fg2 factors size !fg factors contains tbl3 fg2 factors contains tbl3 test value factor graph fg = factor graph fg multiply tbl1 fg multiply tbl2 assignment assn = assignment fg var set to variable 0 1 0 equals 0 08 fg value assn 1e 5 test marginalize factor graph fg = factor graph fg multiply tbl1 fg multiply tbl2 factor marg = fg marginalize vars 1 factor expected = table factor vars 1 0 81 0 9 expected almost equals marg test sum factor graph fg = factor graph fg multiply tbl1 fg multiply tbl2 equals 1 71 fg sum 1e 5 test normalize factor graph fg = factor graph fg multiply tbl1 fg multiply tbl2 fg normalize equals 1 0 fg sum 1e 5 test log normalize factor graph fg = factor graph fg multiply ltbl1 fg multiply ltbl2 fg normalize equals 1 0 fg sum 1e 5 test embedded factor graph factor graph embedded fg = factor graph embedded fg multiply tbl1 embedded fg multiply tbl2 factor graph fg = factor graph fg multiply embedded fg fg multiply tbl3 equals 4 fg var set size equals 2 fg factors size assignment assn = assignment fg var set to variable 4 equals 0 032 fg value assn 1e 5 table factor tbl = fg table equals 4 tbl var set size equals 0 032 tbl value assn 1e 5 test table factor graph fg = factor graph fg multiply tbl1 fg multiply tbl2 table factor actual = fg table table factor expected = table factor tbl1 multiply tbl2 expected almost equals actual test table times fg factor graph fg = factor graph fg multiply tbl1 fg multiply tbl2 factor product = tbl3 multiply fg product table factor equals 4 product var set size assignment assn = assignment product var set to variable 4 equals 0 032 product value assn 1e 5 test log table times fg factor graph fg = factor graph fg multiply tbl1 fg multiply tbl2 factor product = ltbl1 multiply fg product table factor equals 3 product var set size assignment assn = assignment product var set to variable 3 equals 0 128 product value assn 1e 5 test remove factor graph fg = factor graph fg multiply tbl1 fg multiply tbl2 equals 2 fg get degree vars 1 fg divide tbl1 equals 2 fg var set size assignment assn = assignment fg var set to variable 2 equals 0 2 fg value assn 1e 5 nvs = 0 iterator it = fg var set iterator it has next it next nvs++ equals 1 nvs equals 1 fg get degree vars 1 fg get 0 != fg get 1 equals vars 1 fg get 0 equals vars 2 fg get 1 test redundant domains factor graph fg = factor graph fg multiply tbl1 fg multiply tbl2 fg multiply ltbl1 equals 3 fg var set size equals wrong factors in f g was +fg dump to 3 fg factors size assignment assn = assignment fg var set to variable 3 equals 0 128 fg value assn 1e 5 uniform mdlstr = v a r sigma u1 u2 continuous + v a r x1 x2 2 + sigma ~ uniform 0 5 0 5 + u1 ~ uniform 0 5 0 5 + u2 ~ uniform 0 5 0 5 + x1 x2 ~ binary pair sigma + x1 ~ unary u1 + x2 ~ unary u2 test continous sample i o model reader reader = model reader factor graph fg = reader read model buffered reader reader uniform mdlstr randoms r = randoms 324143 assignment all assn = assignment i = 0 i < 10000 i++ assignment row = fg sample r all assn add row row variable x1 = fg find variable x1 assignment assn1 = assignment all assn marginalize x1 col = assn1 get column x1 mean = matrix ops sum col col length equals 0 5 mean 0 025 uniform mdlstr2 = v a r sigma u1 u2 continuous + v a r x1 x2 2 + sigma ~ normal 0 0 0 2 + u1 ~ normal 0 0 0 2 + u2 ~ normal 0 0 0 2 + x1 x2 ~ binary pair sigma + x1 ~ unary u1 + x2 ~ unary u2 test continous sample2 i o model reader reader = model reader factor graph fg = reader read model buffered reader reader uniform mdlstr2 randoms r = randoms 324143 assignment all assn = assignment i = 0 i < 10000 i++ assignment row = fg sample r all assn add row row variable x1 = fg find variable x2 assignment assn1 = assignment all assn marginalize x1 col = assn1 get column x1 mean = matrix ops sum col col length equals 0 5 mean 0 01 variable x2 = fg find variable x2 assignment assn2 = assignment all assn marginalize x2 col2 = assn2 get column x2 mean2 = matrix ops sum col2 col2 length equals 0 5 mean2 0 025 test all factors i o model reader reader = model reader factor graph fg = reader read model buffered reader reader uniform mdlstr2 variable var = variable 2 var set label v0 list lst = fg all factors var equals 0 lst size test all factors of2 i o variable x1 = variable 2 variable x2 = variable 2 factor graph fg = factor graph fg add factor table factor x1 fg add factor table factor x2 fg add factor table factor variable x1 x2 list lst = fg all factors x1 equals 1 lst size iterator it = lst iterator it has next factor f = factor it next equals 1 f var set size f var set contains x1 hash var set vs = hash var set variable x1 x2 list lst2 = fg all factors vs equals 1 lst2 size factor f = factor lst2 get 0 f var set equals vs test table2 factor f1 = table factor vars 0 0 6 0 4 factor f2 = constant factor 2 0 factor graph fg = factor graph factor f1 f2 table factor tbl = fg table arrays equals 0 6 2 0 0 4 2 0 tbl to value test clear factor graph fg = factor graph fg multiply tbl1 fg multiply tbl2 equals 3 fg num variables equals 2 fg factors size fg clear equals 0 fg num variables equals 0 fg factors size vi = 0 vi < tbl1 var set size vi++ !fg contains var tbl1 get variable vi vi = 0 vi < tbl2 var set size vi++ !fg contains var tbl2 get variable vi test cache expanding factor graph base fg = random graphs random frustrated grid 25 1 0 random 3324879 assignment assn = assignment base fg base fg num variables val = base fg log value assn timing timing = timing num reps = 100 rep = 0 rep < num reps rep++ factor graph fg = factor graph base fg num variables fi = 0 fi < base fg factors size fi++ fg multiply base fg get factor fi equals val fg log value assn 1e 5 time1 = timing elapsed time timing tick no expansion time rep = 0 rep < num reps rep++ factor graph fg = factor graph fi = 0 fi < base fg factors size fi++ fg multiply base fg get factor fi equals val fg log value assn 1e 5 time2 = timing elapsed time timing tick expansion time time1 < time2 test suite test suite test factor graph throwable test suite suite length > 0 suite = test suite i = 0 i < length i++ suite add test test factor graph i suite = test suite test factor graph suite junit textui test runner run suite 