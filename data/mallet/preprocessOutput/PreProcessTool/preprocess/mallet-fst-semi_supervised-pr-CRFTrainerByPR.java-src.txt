2011 m a l l e t m achine languag e ~mccallum 1 0 further ` l i e n s e semi supervised pr list bit set r f transducer transducer trainer semi supervised state label map semi supervised pr constraints p r constraint optimize limited memory b f g s optimize optimizer types instance list posterior regularization trainer author gregory druck r f trainer p r transducer trainer transducer trainer optimization converged iter num threads p gpv tolerance value q value list< p r constraint> constraints limited memory b f g s bfgs r f crf state label map state label map r f trainer p r r f crf list< p r constraint> constraints crf constraints 1 r f trainer p r r f crf list< p r constraint> constraints num threads crf = crf iter = 0 value = n e g a t i v e i n f i n i t y constraints = constraints p gpv = 10 tolerance = 0 001 num threads = num threads state label map = state label map crf get output alphabet override get iteration iter override transducer get transducer crf override finished training converged map between states in r f f s t and labels set state label map state label map map state label map = map set p gaussian prior variance p gpv p gpv = p gpv set tolerance tolerance tolerance = tolerance override train instance list train num iterations train train 0 num iterations train instance list train min iter max iter train train min iter max iter m a x v a l u e train instance list train min iter max iter max iter per step old value = 0 max = iter + max iter bit set constrained instances = bit set p r constraint constraint constraints constrained instances or constraint pre process train constraint set state label map state label map removed = 0 instance list temp train = train clone empty ii = 0 ii < train size ii++ constrained instances get ii temp train add train get ii removed++ train = temp train err removed + removed + instances that not contain constraints p r auxiliary model model = p r auxiliary model crf constraints iter < max iter++ start time = current time millis train q constraints optimizable p r opt = constraints optimizable p r crf train model num threads bfgs = limited memory b f g s opt bfgs optimize max iter per step e e print stack trace opt shutdown j = 0 j < constraints size j++ constraints get j print q value = opt get complete value contribution q value > 0 use to train p r f optimizable k l opt p = r f optimizable k l crf train model opt get cached dots num threads 1 opt p set gaussian prior variance p gpv limited memory b f g s bfgs p = limited memory b f g s opt p bfgs p optimize max iter per step e e print stack trace opt p shutdown value = opt p get value q value value < 0 err total value = + value + p value = + opt p get value + q value = + q value + err time iteration + format % 2f current time millis start time 1000 + s stopping criteria from b f g s err convergence test + 2 0 math abs value old value + <= + tolerance math abs value + math abs old value + 1e 5 iter >= min iter 2 0 math abs value old value <= tolerance math abs value + math abs old value + 1e 5 err a p value difference below tolerance old value + old value + value + value old value = value run evaluators converged = converged get total value value get q value q value optimizer get optimizer bfgs 