2002 m a l l e t m achine languag e ~mccallum 1 0 further ` l i e n s e classify tui io logging reflect classify classify evaluate types random classify documents run trials print statistics from a vector author andrew mc callum <a href= mailto >mccallum edu< a> calo2 classify classifier classifier l p a l added logger logger = logger get logger calo2 classify get name logger progress logger = progress message logger get logger calo2 classify get name + pl list classifier trainers = list report options = 3 4 report option = 3 4 in dataset report option=arg essentially an mapping names to enums to ints report option data options = train test validation report options = accuracy f1 confusion raw train=0 test =1 validation=2 accuracy=0 f1=1 confusion=2 raw=3 command option spaced strings report = command option spaced strings calo2 classify report train|test|validation accuracy|f1|confusion|raw test accuracy test confusion train accuracy post parsing command option list list raw formatting = siw argi=0 argi<this value length argi++ convert options like report train accuracy report test f1=label a to options first split argument at semicolon out argi + + value argi = value argi fields = split = data set = fields 0 report option = fields 1 report option = fields length >=3 report option = fields 2 out report option + report option find datasource test train validation found data source = i=0 i< report option data options length i++ data set equals report option data options i found data source = !found data source illegal argument unknown argument = + data set + in report + value argi find report option accuracy f1 confusion raw found report option = j=0 j< report option report options length j++ report option equals report option report options j found report option = !found report option illegal argument unknown argument = + report option + in report + value argi mark data set reportion option pair selected report options i j = j == report option f1 make sure a label was specified f1 report option == illegal argument f1 must have label argument in report + value argi pass through argument report option i j = report option report option != illegal argument no arguments after = allowed in report + value argi command option trainer constructor = command option calo2 classify trainer classifier trainer constructor naive bayes trainer constructor used to create a classifier trainer + no appears then \ \ will be prepended and \ trainer \ will be appended + you may use option mutiple times to compare multiple classifiers parse parse something like maxent gaussian prior variance=10 num iterations=20 out = + first split argument at commas fields = split massage constructor name so that max ent max ent trainer max ent trainer all call max ent trainer constructor name = fields 0 constructor name index != 1 contains pass it though parse constructor name ends trainer parse + constructor name + add parens they forgot parse +constructor name+ trainer make trainer name from classifier name find associated we just built = value get get find setters corresponding to parameter names i=1 i<fields length i++ name value pair = fields i split = parameter name = name value pair 0 parameter value = name value pair 1 todo check val present! parameter value parameter value = get interpreter eval parameter value bsh eval e illegal argument interpreter eval on parameter + parameter name + +e found setter = j=0 j<methods length j++ out + j + name + j get name out set + character to upper parameter name at 0 + parameter name substring 1 set + character to upper parameter name at 0 + parameter name substring 1 equals j get name j get parameter types length == 1 out matched + j get name ptypes = j get parameter types out parameter types k=0 k<ptypes length k++ out + k + = + ptypes k get name parameter list = parameter value out argument types k=0 k<parameter list length k++ out + k + = + parameter list k get get name j value parameter list illegal access e out illegal access + e illegal argument access calling setter +e invocation target e out illegal target + e illegal argument target calling setter +e found setter = !found setter out parameter + parameter name + not found on trainer + constructor name out available + constructor name j=0 j<methods length j++ j get name starts set j get parameter types length == 1 out character to lower j get name at 3 + j get name substring 4 illegal argument no setter found parameter + parameter name post parsing command option list list value classifier trainer out v2c post parsing + value classifier trainers add value p a l added to load a classifier from a command option loadmodel = command option calo2 classify load model f i l e n a m e classifier filename in which to write classifier after it has been trained command option output = command option calo2 classify output classifier f i l e n a m e classifier filename in which to write classifier after it has been trained command option input = command option calo2 classify input f i l e n a m e text vectors filename from which to read list training instances use stdin command option training = command option calo2 classify training f i l e n a m e text vectors read training set instance list from + specified input parameter ignored command option test = command option calo2 classify testing f i l e n a m e text vectors read test set instance list to + option specified training parameter must be specified and + input parameter ignored command option validation = command option calo2 classify validation f i l e n a m e text vectors read validation set instance list to + option specified training parameter must be specified and + input parameter ignored command option training proportion option = command option calo2 classify training portion d e i m a l 1 0 fraction instances that should be used training command option validation proportion option = command option calo2 classify validation portion d e i m a l 0 0 fraction instances that should be used validation command option unlabeled proportion option = command option calo2 classify unlabeled portion d e i m a l 0 0 fraction training instances that should have their labels hidden + note that these are taken out training portion not allocated separately command option random seed option = command option calo2 classify random seed i n t e g e r 0 random seed randomly selecting a proportion instance list training command option num trials option = command option calo2 classify num trials i n t e g e r 1 number random train test splits to perform command option classifier evaluator option = command option calo2 classify classifier evaluator o n s t r u t o r constructing a classifier evaluating command option print train accuracy option = command option vectors2 classify print train accuracy true|false after training run resulting classifier on instances in training + and print accuracy command option print test accuracy option = command option vectors2 classify print test accuracy true|false after training run resulting classifier on instances not in training + and print accuracy command option verbosity option = command option calo2 classify verbosity i n t e g e r 1 level messages to print 0 silent 8 most verbose + levels 0 8 correspond to logger predefined levels + off severe warning info config fine finer finest all + value taken from logging properties + which currently defaults to i n f o level 3 command option no overwrite progress messages option = command option calo2 classify no overwrite progress messages true|false suppress writing in place on terminal progess messages repetitive messages + which only latest generally interest bsh eval i o process command line options command option set summary calo2 classify a tool training saving and printing diagnostics from a classifier on vectors command option process calo2 classify handle trainer here now argument processing doesn t work !trainer constructor was invoked classifier trainers add naive bayes trainer !report was invoked report post parsing force postprocessing value verbosity = verbosity option value logger root logger = logger progress logger get root logger verbosity option was invoked root logger set level logger logging levels verbosity no overwrite progress messages option value == install special formatting progress messages find console handler on root logger change formatter to one that knows about progress messages handler handlers = root logger get handlers i = 0 i < handlers length i++ handlers i console handler handlers i set formatter progress message log formatter separate ilists = test was invoked || training was invoked || validation was invoked instance list ilist=null instance list test ilist=null instance list training ilist=null instance list validation ilist=null !separate ilists normal input specified read in instance list from stdin input filename ilist = instance list load input value user specified separate files testing and training sets training ilist = instance list load training value logger info training vectors loaded from + training value test was invoked test ilist = instance list load test value logger info testing vectors loaded from + test value validation was invoked validation ilist = instance list load validation value logger info validation vectors loaded from + validation value num trials = num trials option value random r = random seed option was invoked ? random random seed option value random classifier trainer trainers = classifier trainer classifier trainers size i = 0 i < classifier trainers size i++ trainers i = classifier trainer classifier trainers get i logger fine trainer specified = +trainers i to train accuracy = trainers length num trials test accuracy = trainers length num trials validation accuracy = trainers length num trials train confusion matrix = trainers length num trials test confusion matrix = trainers length num trials validation confusion matrix = trainers length num trials t = training proportion option value v = validation proportion option value !separate ilists logger info training portion = + t logger info unlabeled training sub portion = +unlabeled proportion option value logger info validation portion = + v logger info testing portion = + 1 v t i=0 i<3 i++ j=0 j<4 j++ out print + report options i j out p a l initialize a classifier to be used each trial p a l use to load a classifier loadmodel was invoked filename = loadmodel value filename = output value trainers length > 1 filename = filename+trainers to num trials > 1 filename = filename+ trial +trial index output stream oos = output stream output stream filename oos write classifier input stream iis = input stream input stream filename classifier l = classifier iis read iis close e e print stack trace illegal argument couldn t read classifier from filename + filename p a l trial index = 0 trial index < num trials trial index++ out trial + trial index + instance list ilists bit set unlabeled indices = !separate ilists ilists = ilist split r t 1 t v v ilists = instance list 3 ilists 0 = training ilist ilists 1 = test ilist ilists 2 = test ilist unlabeled proportion option value > 0 unlabeled indices = randoms r next next bit set ilists 0 size unlabeled proportion option value info gain ig = info gain ilists 0 igl = math min 10 ig num locations i = 0 i < igl i++ out info gain +ig get at rank i + = +ig get value at rank i ig print feature selection selected features = feature selection ig 8000 ilists 0 set feature selection selected features odds ratio feature inducer orfi = odds ratio feature inducer ilists 0 orfi induce features ilists 0 out training +ilists 0 size + instances time = trainers length = 0 < trainers length c++ time = current time millis out trial + trial index + training + trainers to + +ilists 0 size + instances unlabeled proportion option value > 0 ilists 0 hide some labels unlabeled indices classifier classifier loadmodel was invoked classifier = classifier l classifier = trainers train ilists 0 unlabeled proportion option value > 0 ilists 0 unhide all labels out trial + trial index + training + trainers to + finished time = current time millis time trial train trial = trial classifier ilists 0 ilists 1 size > 0 trial test trial = trial classifier ilists 1 trial validation trial = trial classifier ilists 2 ilists 0 size >0 train confusion matrix trial index = confusion matrix train trial to ilists 1 size >0 test confusion matrix trial index = confusion matrix test trial to ilists 2 size >0 validation confusion matrix trial index = confusion matrix validation trial to train accuracy trial index = train trial get accuracy test accuracy trial index = test trial get accuracy validation accuracy trial index = validation trial get accuracy output was invoked filename = output value trainers length > 1 filename = filename+trainers to num trials > 1 filename = filename+ trial +trial index output stream oos = output stream output stream filename oos write classifier oos close e e print stack trace illegal argument couldn t write classifier to filename + filename reporting raw output report options report option train report option raw out trial + trial index + trainer + trainers to out raw training data print trial classification train trial report options report option test report option raw out trial + trial index + trainer + trainers to out raw testing data print trial classification test trial report options report option validation report option raw out trial + trial index + trainer + trainers to out raw validation data print trial classification validation trial train report options report option train report option confusion out trial + trial index + trainer + trainers to + training data confusion matrix ilists 0 size >0 out train confusion matrix trial index report options report option train report option accuracy out trial + trial index + trainer + trainers to + training data accuracy= + train accuracy trial index report options report option train report option f1 label = report option report option train report option f1 out trial + trial index + trainer + trainers to + training data f1 + label + = + train trial get f1 label validation report options report option validation report option confusion out trial + trial index + trainer + trainers to + validation data confusion matrix ilists 2 size >0 out validation confusion matrix trial index report options report option validation report option accuracy out trial + trial index + trainer + trainers to + validation data accuracy= + validation accuracy trial index report options report option validation report option f1 label = report option report option validation report option f1 out trial + trial index + trainer + trainers to + validation data f1 + label + = + validation trial get f1 label test report options report option test report option confusion out trial + trial index + trainer + trainers to + test data confusion matrix ilists 1 size >0 out test confusion matrix trial index report options report option test report option accuracy out trial + trial index + trainer + trainers to + test data accuracy= + test accuracy trial index report options report option test report option f1 label = report option report option test report option f1 out trial + trial index + trainer + trainers to + test data f1 + label + = + test trial get f1 label end each trainer end each trial reporting train|test|validation accuracy|f1|confusion|raw c=0 < trainers length c++ out +trainers to report options report option train report option accuracy out summary train accuracy mean = + matrix ops mean train accuracy + stddev = + matrix ops stddev train accuracy + stderr = + matrix ops stderr train accuracy report options report option validation report option accuracy out summary validation accuracy mean = + matrix ops mean validation accuracy + stddev = + matrix ops stddev validation accuracy + stderr = + matrix ops stderr validation accuracy report options report option test report option accuracy out summary test accuracy mean = + matrix ops mean test accuracy + stddev = + matrix ops stddev test accuracy + stderr = + matrix ops stderr test accuracy end each trainer print trial classification trial trial i = 0 i < trial size i++ instance instance = trial get i get instance out print instance get name + + instance get target + labeling labeling = trial get i get labeling j = 0 j < labeling num locations j++ out print labeling get label at rank j to + + labeling get value at rank j + out 