2011 m a l l e t m achine languag e ~mccallum 1 0 further ` l i e n s e semi supervised pr io serializable list list concurrent callable concurrent execution concurrent executors concurrent future concurrent thread pool executor logging logger r f transducer transducer transition iterator semi supervised pr constraints p r constraint optimize optimizable gradient value types feature vector sequence types instance types instance list types sequence logger optimizable e step i projection in posterior regularization p r author kedar bellare author gregory druck constraints optimizable p r serializable gradient value logger logger = logger get logger constraints optimizable p r get name serial u = 1 cache stale num num threads instance list training set cached value = 123456789 cached gradient r f crf thread pool executor executor cached dots p r auxiliary model model constraints optimizable p r r f crf instance list ilist p r auxiliary model model crf ilist model 1 constraints optimizable p r r f crf instance list ilist p r auxiliary model model num threads crf = crf training set = ilist model = model num = model num cached gradient = num cache stale = num threads = num threads executor = thread pool executor executors fixed thread pool num threads cache dot products cache dot products cached dots = training set size i = 0 i < training set size i++ feature vector sequence input = feature vector sequence training set get i get data cached dots i = input size crf num states crf num states j = 0 j < input size j++ k = 0 k < crf num states k++ l = 0 l < crf num states l++ cached dots i j k l = transducer i m p o s s i b l e w e i g h t j = 0 j < input size j++ k = 0 k < crf num states k++ transition iterator iter = crf get state k transition iterator input j iter has next l = iter next get index cached dots i j k l = iter get weight get num num get params model get params get parameter index model get parameter index set params cache stale = model set params set parameter index value cache stale = model set parameter index value get expectation value model zero expectations updating tasks list< callable< double>> tasks = list< callable< double>> increment = training set size num threads start = 0 end = increment task index = 0 task index < num threads task index++ tasks add expectation task start end model copy start = end task index == num threads 2 end = training set size end = start + increment value = 0 list< future< double>> results = executor all tasks compute value future< double> f results value += f get execution ee ee print stack trace interrupted ie ie print stack trace combine results combine model tasks mu b w ||mu||^2 value += model get value value log probability training sequence labels and prior over get value cache stale cached value = get expectation value model get value gradient cached gradient cache stale = logger info get value auxiliary = + cached value cached value get complete value contribution cache stale get value value = model get complete value contribution value get value gradient buffer cache stale get value arraycopy cached gradient 0 buffer 0 cached gradient length combine p r auxiliary model orig list< callable< double>> tasks i = 0 i < tasks size i++ expectation task task = expectation task tasks get i p r auxiliary model model = task get model copy ci = 0 ci < model num constraints ci++ p r constraint orig constraint = orig get constraint ci p r constraint copy constraint = model get constraint ci expectation = orig constraint num dimensions copy constraint get expectations expectation orig constraint add expectations expectation shutdown executor shutdown get cached dots cached dots p r auxiliary model get aux model model expectation task callable< double> start end p r auxiliary model model copy expectation task start end p r auxiliary model model copy start = start end = end model copy = model copy call value = 0 ii = start ii < end ii++ instance inst = training set get ii sequence input = sequence inst get data log z value = sum lattice p r crf ii input model copy cached dots ii get total weight value p r auxiliary model get model copy model copy 