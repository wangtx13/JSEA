2011 m a l l e t m achine languag e ~mccallum 1 0 further ` l i e n s e classify constraints pr gnu trove t hash map types feature vector expectation constraint use posterior regularization p r penalizes l 2^2 difference from target author gregory druck max ent l2 f l p r constraints max ent f l p r constraints t hash map constraint indices normalize max ent l2 f l p r constraints num features num labels use values normalize num features num labels use values constraint indices = t hash map normalize = normalize override add constraint fi ex weight constraints put fi max ent l2 f l p r constraint ex weight constraint indices put fi constraint indices size max ent l2 f l p r constraint max ent f l p r constraint max ent l2 f l p r constraint target weight target weight num dimensions constraints size num labels get auxiliary value contribution value = 0 fi constraints keys ci = constraint indices get fi = 0 < num labels li++ = ci + constraints size targets dot value += constraints get fi target regularization value = 2 constraints get fi weight value get gradient gradient fi constraints keys ci = constraint indices get fi norm normalize norm = constraints get fi count norm = 1 = 0 < num labels li++ = ci + constraints size gradient ci + constraints size = constraints get fi target constraints get fi expectation norm regularization gradient ci + constraints size = constraints get fi weight get complete value contribution value = 0 fi constraints keys norm normalize norm = constraints get fi count norm = 1 = 0 < num labels li++ value = constraints get fi weight math pow constraints get fi target constraints get fi expectation norm 2 2 value get score feature vector input label score = 0 i = 0 i < index cache size i++ ci = constraint indices get index cache get quick i = ci + label constraints size norm normalize norm = constraints get index cache get quick i count norm = 1 use values score += value cache get quick i norm score += norm score 