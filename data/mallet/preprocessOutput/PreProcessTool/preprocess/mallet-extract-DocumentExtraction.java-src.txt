2003 m a l l e t m achine languag e ~mccallum 1 0 further ` l i e n s e extract jdom element jdom document jdom namespace jdom text jdom output xml outputter types io i o io input stream io output stream io serializable list collections comparator list gnu trove t hash map created oct 12 2004 author < a h r e f= mailto casutton edu>casutton edu< a> $ document extraction v 1 1 2007 10 22 21 37 44 exp $ t o d o add place where user can have general transducers to change r f tokenization into labeled spans t o d o add field r f s labeled tokenizationpublic document extraction serializable tokenization input sequence predicted labels label sequence target labeled spans extracted spans labeled spans target spans document label background tag name document extraction name label alphabet dict tokenization input sequence predicted background name dict input predicted background b i o tokenization filter document extraction name label alphabet dict tokenization input sequence predicted sequence target background name dict input predicted target background b i o tokenization filter document extraction name label alphabet dict tokenization input sequence predicted sequence target background tokenization filter filter document = input get document name = name input size == predicted size background tag = dict lookup label background input = input predicted labels = predicted extracted spans = filter construct labeled spans dict document background tag input predicted target != target label sequence target = label sequence target target spans = filter construct labeled spans dict document background tag input target document extraction name label alphabet dict tokenization input labeled spans predicted spans labeled spans spans background document = input get document name = name background tag = dict lookup label background input = input extracted spans = predicted spans target spans = spans get document document tokenization get input input sequence get predicted labels predicted labels labeled spans get extracted spans extracted spans labeled spans get target spans target spans label sequence get target target get name name label get background tag background tag xxx nyi span subspan start end unsupported operation not yet document to xml document to xml document doc namespace n o n a m e s p a e document to xml document root elt name namespace ns element element = element root elt name ns i = 0 i < extracted spans size i++ labeled span span = labeled span extracted spans get i label tag = span get label tag == background tag jdom parent p = element add content span get text element field = element tag to ns field set text span get text element add content field document element does not non overlap sanity checking document to xml document root elt name namespace ns list ordered start = list extracted spans collections sort ordered start comparator compare o o1 start1 = span o get start idx start2 = span o1 get start idx compare start1 start2 list roots = list ordered start t hash map children = t hash map i = 0 i < ordered start size i++ labeled span child = labeled span ordered start get i j = i 1 j >= 0 j labeled span parent = labeled span ordered start get j parent subspan child list child list = list children get parent child list == child list = list children put parent child list roots remove child child list add child sequence doc = sequence document span whole doc = span doc 0 doc length document generate element root elt name whole doc roots children element generate element parent name span span list child spans t hash map tree element parent elt = element parent name child spans == || child spans empty parent elt set content text span get text list child elts = list child spans size start = span get start idx current = 0 i = 0 i < child spans size i++ labeled span child span = labeled span child spans get i label child label = child span get label child start = child span get start idx start child start > current child elts add text span get text substring current child start child label == background tag child elts add text child span get text name = child label get entry to list grandchildren = list tree get child span child elts add generate element name child span grandchildren tree current = child span get end idx start current < span get end idx child elts add text span get text substring current parent elt add content child elts parent elt to xml document jdom = to xml document xml outputter outputter = xml outputter outputter output jdom size extracted spans size serialization garbage serial u = 1 l u r r e n t s e r i a l v e r s i o n = 1 write output stream out i o out write out write u r r e n t s e r i a l v e r s i o n read input stream in i o not found in read in read read 