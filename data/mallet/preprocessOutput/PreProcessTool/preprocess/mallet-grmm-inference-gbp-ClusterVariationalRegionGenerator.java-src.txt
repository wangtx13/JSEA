2003 m a l l e t m achine languag e ~mccallum 1 0 further ` l i e n s e inference gbp logging logger types factor types factor graph types undirected grid types variable collection utils logger created jun 1 2005 author < a h r e f= mailto casutton edu>casutton edu< a> $ cluster variational region generator v 1 1 2007 10 22 21 37 58 exp $ cluster variational region generator region graph generator logger logger = logger get logger cluster variational region generator get name debug = base region region cluster variational region generator factor region cluster variational region generator base region region region = region region graph construct region graph factor graph mdl region graph rg = region graph depth = 0 list base regions = region compute base regions mdl list these regions = base regions !these regions empty debug out depth 0 regions + collection utils dump to these regions list overlaps = compute overlaps these regions add edges overlaps rg these regions overlaps these regions = overlaps depth++ rg compute inference caches logger info cluster variational region generator number regions +rg size + number edges +rg num edges rg list compute overlaps list regions list overlaps = list iterator it1 = regions iterator it1 has next region r1 = region it1 next iterator it2 = regions iterator it2 has next region r2 = region it2 next r1 != r2 collection intersection = collection utils intersection r1 vars r2 vars !intersection empty !any subsumes overlaps intersection collection ptl set = collection utils intersection r1 factors r2 factors variable vars = variable intersection to variable intersection size factor ptls = factor ptl set to factor ptl set size region r = region vars ptls overlaps add r we can still have subsumed regions in list smaller region was added first list iterator it = overlaps list iterator it has next region region = region it next list other regions = overlaps sub list it next index overlaps size any subsumes other regions region vars it remove overlaps any region in regions contains all variables in vars any subsumes list regions collection vars iterator it = regions iterator it has next region region = region it next region vars contains all vars add edges overlaps region graph rg list from list list to list iterator from it = from list iterator from it has next region from = region from it next iterator to it = to list iterator to it has next region to = region to it next from vars contains all to vars rg add from to computing base regions remove subsumed regions list regions list iterator it = regions list iterator it has next region region = region it next iterator it2 = regions iterator it2 has next region r2 = region it2 next r2 != region r2 vars size >= region vars size r2 vars contains all region vars it remove add all factors factor graph mdl list regions iterator it = regions iterator it has next region region = region it next iterator p it = mdl factors iterator p it has next factor ptl = factor p it next region vars contains all ptl var set region factors add ptl base region a list top level regions use in cluster variational mdl an undirected model a list regions no region in list may subsume another list compute base regions factor graph mdl region where each top level region consists a single factor node model pairwise equivalent to using bethe free energy factor region base region list compute base regions factor graph mdl list regions = list mdl factors size iterator it = mdl factors iterator it has next factor ptl = factor it next regions add region ptl remove subsumed regions regions add all factors mdl regions regions grid2x2 region base region list compute base regions factor graph mdl list regions = list undirected grid grid = undirected grid mdl x = 0 x < grid get width 1 x++ y = 0 y < grid get height 1 y++ variable vars = variable grid get x y grid get x y+1 grid get x+1 y+1 grid get x+1 y regions add region vars factor 0 add all factors mdl regions regions 