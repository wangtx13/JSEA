2003 m a l l e t m achine languag e ~mccallum 1 0 further ` l i e n s e inference users casutton timing list list iterator types randoms timing created mar 28 2005 author < a h r e f= mailto casutton edu>casutton edu< a> $ gibbs sampler v 1 1 2007 10 22 21 37 49 exp $ gibbs sampler sampler burnin factor all cpts randoms r = randoms 324231 gibbs sampler gibbs sampler burnin burnin = burnin gibbs sampler randoms r burnin burnin = burnin r = r set burnin burnin burnin = burnin set random randoms r r = r assignment sample factor graph mdl n init graph mdl assignment assn = initial assignment mdl assn == illegal argument gibbs sampler could not find feasible assignment model +mdl timing timing = timing i = 0 i < burnin i++ assn = one pass mdl assn timing tick burnin assignment ret = assignment i = 0 i < n i++ assn = one pass mdl assn ret add row assn timing tick sampling ret assignment initial assignment factor graph mdl assignment assn = assignment mdl mdl num variables mdl log value assn > n e g a t i v e i n f i n i t y assn assn = assignment initial assignment rec mdl assn 0 backtracking search a feasible assignment assignment initial assignment rec factor graph mdl assignment assn fi fi >= mdl factors size assn factor f = mdl get factor fi factor sliced = f slice assn sliced var set empty val = f value assn val > 1e 50 initial assignment rec mdl assn fi+1 assignment iterator it = sliced assignment iterator it has next val = sliced value it val > 1e 50 assignment assn = assignment union assn it assignment assignment assn ret = initial assignment rec mdl assn fi+1 assn ret != assn ret it advance assignment one pass factor graph mdl assignment initial assignment ret = assignment initial duplicate vidx = 0 vidx < ret size vidx++ variable var = mdl get vidx discrete factor subcpt = construct conditional cpt mdl var ret value = subcpt sample location r ret set value var value ret warning destructively modifies ret s assignment to full assn i could save and restore but i t care discrete factor construct conditional cpt factor graph mdl variable var assignment full assn list ptl list = mdl all factors containing var log table factor ptl = log table factor var assignment iterator it = ptl assignment iterator it has next it advance assignment var assn = it assignment full assn set value var var assn get var ptl set raw value var assn sum values ptl list full assn ptl normalize ptl sum values list ptl list assignment assn sum = 0 iterator it = ptl list iterator it has next factor ptl = factor it next sum += ptl log value assn sum 