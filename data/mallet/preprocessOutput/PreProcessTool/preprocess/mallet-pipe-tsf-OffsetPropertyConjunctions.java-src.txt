2002 m a l l e t m achine languag e ~mccallum 1 0 further ` l i e n s e create features from all possible conjunctions other possibly position offset features author andrew mc callum <a href= mailto >mccallum edu< a> pipe tsf io pipe pipe types instance types token types token sequence property list offset property conjunctions pipe serializable conjunctions include original singletons property key to include all old previous singleton features pass 0 a conjunction at current time step pass 0 0 a conjunction current and previous pass 0 1 a conjunction current and next two pass 0 1 2 offset property conjunctions include original singletons property key conjunctions conjunctions = conjunctions include original singletons = include original singletons property key = property key offset property conjunctions include original singletons conjunctions include original singletons conjunctions offset property conjunctions conjunctions conjunctions instance pipe instance carrier token sequence ts = token sequence carrier get data ts size = ts size property list oldfs = property list ts size property list newfs = property list ts size i = 0 i < ts size i++ oldfs i = ts get i get features include original singletons i = 0 i < ts size i++ newfs i = ts get i get features i = 0 i < ts size i++ out offset property conjunctions ts index= +i+ conjunction = conjunction list j = 0 j < conjunctions length j++ make sure that offsets in conjunction are all available at position k = 0 k < conjunctions j length k++ conjunctions j k + i < 0 || conjunctions j k + i > ts size 1 || oldfs i+conjunctions j k == conjunction list out print +conjunctions j k out print add features conjunction conjunctions j length == 1 offset = conjunctions j 0 offset == 0 include original singletons illegal argument original singletons already there property list iterator iter = oldfs i+offset iterator iter has next iter next property key != !property key equals iter get key key = iter get key + offset==0 ? +offset newfs i = property list add key iter get numeric value newfs i conjunctions j length == 2 out token= +ts get token i get text + conjunction index= +j offset0 = conjunctions j 0 offset1 = conjunctions j 1 property list iterator iter0 = oldfs i+offset0 iterator iter0i = 1 iter0 has next iter0i++ iter0 next property key != !property key equals iter0 get key property list iterator iter1 = oldfs i+offset1 iterator iter1i = 1 iter1 has next iter1i++ iter1 next property key != !property key equals iter1 get key avoid redundant doubling feature space include only upper triangle out off0= +offset0+ off1= +offset1+ iter0i= +iter0i+ iter1i= +iter1i offset0 == offset1 iter1i <= iter0i out >off0= +offset0+ off1= +offset1+ iter0i= +iter0i+ iter1i= +iter1i key = iter0 get key + offset0==0 ? +offset0 + +iter1 get key + offset1==0 ? +offset1 newfs i = property list add key iter0 get numeric value iter1 get numeric value newfs i conjunctions j length == 3 offset0 = conjunctions j 0 offset1 = conjunctions j 1 offset2 = conjunctions j 2 property list iterator iter0 = oldfs i+offset0 iterator iter0i = 1 iter0 has next iter0i++ iter0 next property key != !property key equals iter0 get key property list iterator iter1 = oldfs i+offset1 iterator iter1i = 1 iter1 has next iter1i++ iter1 next property key != !property key equals iter1 get key avoid redundant doubling feature space include only upper triangle offset0 == offset1 iter1i <= iter0i property list iterator iter2 = oldfs i+offset2 iterator iter2i = 1 iter2 has next iter2i++ iter2 next property key != !property key equals iter2 get key avoid redundant doubling feature space include only upper triangle offset1 == offset2 iter2i <= iter1i key = iter0 get key + offset0==0 ? +offset0 + +iter1 get key + offset1==0 ? +offset1 + +iter2 get key + offset2==0 ? +offset2 newfs i = property list add key iter0 get numeric value iter1 get numeric value iter2 get numeric value newfs i unsupported operation conjunctions length 4 or more not yet put property lists in place i = 0 i < ts size i++ ts get i set features newfs i carrier serialization serial u = 1 u r r e n t s e r i a l v e r s i o n = 0 n u l l i n t e g e r = 1 write output stream out i o out write u r r e n t s e r i a l v e r s i o n size1 size2 size1 = conjunctions == ? n u l l i n t e g e r conjunctions length out write size1 size1 != n u l l i n t e g e r i = 0 i <size1 i++ size2 = conjunctions i == ? n u l l i n t e g e r conjunctions length out write size2 size2 != n u l l i n t e g e r j = 0 j <size2 j++ out write conjunctions i j out write include original singletons read input stream in i o not found size1 size2 = in read size1 = in read size1 == n u l l i n t e g e r conjunctions = conjunctions = size1 i = 0 i < size1 i++ size2 = in read size2 == n u l l i n t e g e r conjunctions i = conjunctions i = size2 j = 0 j < size2 j++ conjunctions i j = in read include original singletons = in read 