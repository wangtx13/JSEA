2011 m a l l e t m achine languag e ~mccallum 1 0 further ` l i e n s e classify constraints ge types matrix ops maths expectation constraint use g e penalizes k l divergence from target multiple constraints are grouped together here to make things more efficient author gregory druck max ent k l f l g e constraints max ent f l g e constraints max ent k l f l g e constraints num features num labels use values num features num labels use values get value value = 0 0 fi constraints keys max ent f l g e constraint constraint = constraints get fi constraint count > 0 0 constraint value = 0 0 label index = 0 label index < num labels ++label index constraint target label index > 0 0 target non zero and expectation 0 infinite penalty constraint expectation label index == 0 0 n e g a t i v e i n f i n i t y p log q p log p negative k l constraint value += constraint target label index math log constraint expectation label index constraint count math log constraint target label index ! na n constraint value ! infinite constraint value value += constraint value constraint weight value override add constraint fi ex weight maths almost equals matrix ops sum ex 1 constraints put fi max ent k l f l g e constraint ex weight max ent k l f l g e constraint max ent f l g e constraint max ent k l f l g e constraint target weight target weight override get value count != 0 target == 0 expectation == 0 0 weight target expectation 