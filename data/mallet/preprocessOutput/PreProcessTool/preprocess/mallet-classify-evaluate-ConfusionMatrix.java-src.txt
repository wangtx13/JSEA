2002 m a l l e t m achine languag e ~mccallum program free you can redistribute it and or modify it g n u general free foundation either 2 or at your option any later program distributed in hope that it will be useful but w i t h o u t a n y w a r r a n t y without even implied warranty m e r h a n t a b i l i t y or f i t n e s s f o r a p a r t i u l a r p u r p o s e more details g n u general and r e a d m e l e g a l you should have received a copy g n u general along program not write to free foundation inc 59 temple place suite 330 boston m a 02111 1307 u s a author andrew mc callum <a href= mailto >mccallum edu< a> classify evaluate list hash map logging text classify classification classify trial types instance types label types label alphabet types label vector types labeling types matrix ops logger calculates and prints confusion matrix accuracy and precision a given clasification trial confusion matrix logger logger = logger get logger confusion matrix get name num classes list classifications from trial list classifications 2 d confusion matrix indexed actual predicted values trial trial constructs matrix and calculates values t trial to build matrix from confusion matrix trial t trial = t classifications = t labeling temp labeling = classification classifications get 0 get labeling num classes = temp labeling get label alphabet size values = num classes num classes i=0 i < classifications size i++ label vector lv = classification classifications get i get label vector instance inst = classification classifications get i get instance best index = lv get best index correct index = inst get labeling get best index correct index != 1 out best index= +best index+ correct= +correct index values correct index best index ++ count at row i column j predicted value i j i >= 0 j >= 0 i < num classes j < num classes values i j append justified buffer sb i zero dot i < 100 sb append i < 10 sb append i == 0 zero dot sb append sb append +i to buffer sb = buffer max label name length = 0 label alphabet label alphabet = trial get classifier get label alphabet i = 0 i < num classes i++ len = label alphabet lookup label i to length max label name length < len max label name length = len these counts will be integers but we ll keep them doubles so we can divide later correct label counts = values length i = 0 i < correct label counts length i++ sum number instances whose correct i correct label counts i = matrix ops sum values i find count most frequent and divide that total number instances baseline accuracy = matrix ops max correct label counts matrix ops sum correct label counts sb append confusion matrix row=true column=predicted accuracy= +trial get accuracy + most frequent tag baseline= +baseline accuracy+ i = 0 i < max label name length 5+4 i++ sb append sb append label c2 = 0 c2 < math min 10 num classes c2++ sb append +c2 c2 = 10 c2 < num classes c2++ sb append + c2 sb append |total = 0 < num classes c++ append justified sb label name = label alphabet lookup label to i = 0 i < max label name length label name length i++ sb append sb append +label name+ c2 = 0 c2 < num classes c2++ append justified sb values c2 sb append sb append | + matrix ops sum values sb append sb to precision predicted get precision predicted index total = 0 index=0 index < num classes index++ total += values index predicted index total == 0 0 0 values predicted index predicted index total percent time that class2 when class1 predicted get confusion between class1 class2 total = 0 index=0 index < num classes index++ total += values index class1 total == 0 0 0 values class2 class1 total percentage instances label = index get prior index sum = 0 i=0 i < num classes i++ sum += values index i sum classifications size prints to stdout confusion matrix frequency precision and recall print total precision = 0 total recall = 0 total f1 = 0 hash map index2class = hash map label vector lv = classification classifications get 0 get label vector decimal format df = decimal format ### ## num instances = num classes i=0 i<this num classes i++ count = 0 j=0 j<this num classes j++ count += values i j num instances i = count label = lv label at location i to out index +i+ +label+ +count+ instances + df format 100 count classifications size + % index2class put i label out confusion matrix i=0 i<this num classes i++ j=0 j<this num classes j++ out print values j i + out i=0 i<this num classes i++ recall = 100 0 values j j num instances i precision row count = 0 j=0 j<this num classes j++ row count += values j i row count == 0 precision = 0 precision = 100 0 values j j row count f1 precision + recall == 0 0 f1 = 0 f1 = 2 precision recall precision + recall out + index2class get i out f1= +df format f1 + % out recall= +df format recall + % out precision= +df format precision + % total precision += precision total recall += recall total f1 += f1 num correct = 0 total instances = 0 i=0 i<this num classes i++ num correct += values j j total instances+=num instances i out overall accuracy= + df format 100 0 num correct total instances + % out average f1 + total f1 num classes + average precision + total precision num classes + average recall + total recall num classes 