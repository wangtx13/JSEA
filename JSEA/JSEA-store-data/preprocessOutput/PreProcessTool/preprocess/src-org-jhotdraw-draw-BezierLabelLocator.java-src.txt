# poly line decoration locator 1 0 3 februar 2004 copyright c 1996 2006 by the original author of jhotdraw and all it contributor jhotdraw org all right reserve software is the confidential and proprietary information of jhotdraw org confidential information you shall not disclose such confidential information and shall use it only in accordance with the term of the license agreement you enter into with jhotdraw org org jhotdraw draw org jhotdraw geom dimension2 d org jhotdraw geom geom org jhotdraw geom org jhotdraw xml dom input org jhotdraw xml dom output org jhotdraw xml dom storable locator locate a position relative to a polyline the position is chosen in a way which is suitable label the polyline the prefer size of the label is use to determine it location author wern randelshof 2 0 2006 01 14 change to support coordinate 1 0 3 februar 2004 create bezi label locator locator dom storable relative position angle distance create a instance constructor is use by dom storable only bezi label locator create a locator relative position the relative position of the label on the polyline 0 0 specifie the start of the polyline 1 0 the end of the polyline value between 0 0 and 1 0 are relative position on the polyline angle the angle of the distance vector distance the length of the distance vector bezi label locator relative position angle distance relative position relative position angle angle distance distance point2 d locate figure owner get relative point bezi figure owner point2 d locate figure owner figure label point2 d relative point get relative label point bezi figure owner label relative point a point2 d on the polyline that is at the provide relative position point2 d get relative point bezi figure owner point2 d point owner get point on path relative position 3 point2 d next point owner get point on path relative position 0 5 ? relative position + 0 1f relative position 0 1f 3 dir math atan2 next point y point y next point x point x relative position 0 5 dir + math p i alpha dir + angle point2 d p point2 d point x + distance math co alpha point y + distance math sin alpha is na n p x p point p a point2 d on the polyline that is at the provide relative position x x x implement and move it to bezi path point2 d get relative label point bezi figure owner figure label get a point on the path an the next point on the path point2 d point owner get point on path relative position 3 point point2 d 0 0 point2 d next point owner get point on path relative position 0 5 ? relative position + 0 1f relative position 0 1f 3 dir math atan2 next point y point y next point x point x relative position 0 5 dir + math p i alpha dir + angle point2 d p point2 d point x + distance math co alpha point y + distance math sin alpha is na n p x p point dimension2 d label dim label get prefer size relative position 0 5 p x point x distance 2 p x point x + distance 2 p y point y south east point2 d p x label dim width 2 p y north east point2 d p x label dim width 2 p y label dim height p x point x p y point y south east point2 d p x p y north east point2 d p x p y label dim height p y point y south west point2 d p x label dim width p y north west point2 d p x label dim width p y label dim height percentage relative position 100 segment relative segment point2 d seg point relative point2 d on the segment n point owner get point count point2 d point owner get point n point 2 point2 d 0 0 percentage 0 segment 0 seg point owner get start point 100 segment owner get point count 2 seg point owner get end point total length 0d seg length n point 1 i 1 i n point i++ seg length i 1 geom length point i 1 x point i 1 y point i x point i y total length + seg length i 1 relative progress percentage total length 101d segment 0 seg min 0d segment 0 segment seg length length 1 segment++ seg min + seg length segment relative progress seg min + seg length segment compute the relative point2 d on the line seg point point2 d relative progress seg min seg point x point segment x seg length segment relative progress + point segment + 1 x relative progress seg length segment + 5 seg point y point segment y seg length segment relative progress + point segment + 1 y relative progress seg length segment + 5 dimension2 d label dim label get prefer size line2 d line line2 d point segment x point segment y point segment + 1 x point segment + 1 y dir math atan2 point segment + 1 y point segment y point segment + 1 x point segment x alpha dir + angle point2 d p point2 d seg point x + distance math co alpha seg point y + distance math sin alpha p x seg point x p y seg point y south east point2 d p x p y north east point2 d p x p y label dim height p y seg point y south west point2 d p x label dim width p y north west point2 d p x label dim width p y label dim height read dom input in relative position in get attribute relative position 0d angle in get attribute angle 0d distance in get attribute distance 0 write dom output out out add attribute relative position relative position out add attribute angle angle out add attribute distance distance 