# bezi bezi line connection 1 0 1 2006 02 06 copyright c 1996 2006 by the original author of jhotdraw and all it contributor jhotdraw org all right reserve software is the confidential and proprietary information of jhotdraw org confidential information you shall not disclose such confidential information and shall use it only in accordance with the term of the license agreement you enter into with jhotdraw org org jhotdraw draw org jhotdraw event geom undo io org jhotdraw geom org jhotdraw xml dom input org jhotdraw xml dom output a line connection is a standard of the connection figure the is with bezi figure author wern randelshof 1 0 1 2006 02 06 fix redo bug 1 0 23 januar 2006 create line connection figure line figure connection figure connector start connector connector end connector liner liner handle figure change in the start and the end figure connection handler connection handler connection handler connection handler figure listener line connection figure owner connection handler line connection figure owner owner owner figure request remove figure event e figure remove figure event evt the comment line below must stay comment out is because we must not set our connector to in order to support reconnection using redo evt get figure owner get start figure || evt get figure owner get end figure owner set start connector owner set end connector owner fire figure request remove figure change figure event e e get source owner get start figure || e get source owner get end figure owner will change owner update connection owner change figure add figure event e figure attribute change figure event e figure area invalidate figure event e create a instance line connection figure d r a w i n g s h a p e a n d b o u n d s ensure that a connection is update the connection wa move basic transform affine transform tx basic transform tx update connection make sure that we are still connect a t t r i b u t e s e d i t i n g get the handle of the figure it the normal polyline handle but add change connection handle at the start and end collection handle create handle detail level list handle handle list handle get node count detail level 0 get liner i 1 n get node count 1 i n i++ handle add bezi node handle i handle add change connection start handle handle add change connection end handle handle c o n n e c t i n g test wheth a figure can be a connection target connection figure cannot be connect and can connect update connection will change get start connector point2 d start get start connector find start start basic set start point start get end connector point2 d end get end connector find end end basic set end point end change validate validate lineout can connect figure start figure end start can connect end can connect connect same connection figure other other get start connector get start connector other get end connector get end connector connector get end connector end connector figure get end figure end connector ? end connector get owner connector get start connector start connector figure get start figure start connector ? start connector get owner note is only testing purpose you can remove the keywoard at any time set end connector connector end connector old end end connector end old end will change basic set end connector end fire undoable edit happen undoable edit get presentation name end verbindung setzen undo cannot undo undo will change basic set end connector old end change redo cannot undo redo will change basic set end connector end change change basic set end connector connector end end end connector end connector get end figure remove figure listener connection handler get start figure handle disconnect get start figure get end figure end connector end end connector get end figure add figure listener connection handler get start figure get end figure handle connect get start figure get end figure update connection note is only testing purpose you can remove the keywoard at any time set start connector connector start connector old start start connector start old start will change basic set start connector start fire undoable edit happen undoable edit get presentation name start verbindung setzen undo cannot undo undo will change basic set start connector old start change redo cannot undo redo will change basic set start connector start change change basic set start connector connector start start start connector start connector get start figure remove figure listener connection handler get end figure handle disconnect get start figure get end figure start connector start start connector get start figure add figure listener connection handler get start figure get end figure handle connect get start figure get end figure update connection c o m p o s i t e f i g u r e s l a y o u t liner get bezi path layout liner get attribute b e z i e r p a t h l a y o u t e r set bezi path layout liner value set attribute b e z i e r p a t h l a y o u t e r value lay out the connection is call when the connection itself change by the connection is recalculate layout connection get start connector get end connector will change liner bpl get bezi path layout bpl bpl lineout get start connector point2 d start get start connector find start start basic set start point start get end connector point2 d end get end connector find end end basic set end point end change c l o n i n g e v e n t h a n d l i n g add notify drawing drawing add notify drawing get start connector get end connector handle connect get start figure get end figure remove notify drawing drawing set start connector set end connector get start connector get end connector handle disconnect get start figure get end figure remove notify drawing handle the disconnection of a connection override to handle event handle disconnect figure start figure end handle the connection of a connection override to handle event handle connect figure start figure end line connection figure clone line connection figure that line connection figure clone that connection handler connection handler that liner that liner liner liner clone that share the same connector that ha to work properly that must be register a a figure listener to the connect figure start connector that start connector connector start connector clone that get start figure add figure listener that connection handler end connector that end connector connector end connector clone that get end figure add figure listener that connection handler that start connector that end connector that handle connect that get start figure that get end figure that update connection that remap map old to will change remap old to figure start figure figure end figure get start figure start figure figure old to get get start figure start figure start figure get start figure get end figure end figure figure old to get get end figure end figure end figure get end figure start figure set start connector start figure find compatible connector get start connector end figure set end connector end figure find compatible connector get end connector update connection change can connect figure start start can connect handle a mouse click handle mouse click point2 d p mouse event evt drawing view view get liner evt get click count 2 will change index basic split segment p 5f view get scale factor index 1 bezi path node node get node index fire undoable edit happen undoable edit redo cannot redo redo will change basic add node index node change undo cannot undo undo will change basic remove node index change change p e r s i s t e n c e read point dom input in i o read point in in open element start connector set start connector connector in read in close element in open element end connector set end connector connector in read in close element read dom input in i o read point in read attribute in read liner in read liner dom input in i o in get element count liner 0 in open element liner liner liner in read in close element write dom output out i o write point out write attribute out write liner out write liner dom output out i o liner out open element liner out write liner out close element write point dom output out i o write point out out open element start connector out write get start connector out close element out open element end connector out write get end connector out close element set liner liner value will change liner value change basic set node index bezi path node p index 0 index get point count 1 get start connector point2 d start get start connector find start start basic set start point start get end connector point2 d end get end connector find end end basic set end point end basic set node index p basic set point index point2 d p index 0 index get point count 1 get start connector point2 d start get start connector find start start basic set start point start get end connector point2 d end get end connector find end end basic set end point end basic set point index p lineout liner liner lineout f i x m e liner must work with a p i of line connection bezi path get bezi path path liner get liner liner set start point point2 d p set point 0 p set point index point2 d p set point index 0 p set end point point2 d p set point get point count 1 p reverse connection start connector end connector handle disconnect start connector get owner end connector get owner connector tmp c start connector start connector end connector end connector tmp c point2 d tmp p get start point set start point get end point set end point tmp p handle connect start connector get owner end connector get owner update connection 