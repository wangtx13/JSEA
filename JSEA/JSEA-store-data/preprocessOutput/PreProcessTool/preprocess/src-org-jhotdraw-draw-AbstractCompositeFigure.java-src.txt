# composite figure 2 2 2006 07 08 1996 2006 contributor right reserve thi disclose accordance term enter draw io i o geom undo geom xml dom input xml dom output figure compose several child composite figure doesn t define layout behavior up subclasser arrange contain child wern randelshof 2 2 2006 07 08 minor change 2 1 2006 03 15 fire undoable edit on attribute change 2 0 1 2006 02 06 fix concurrent modification remove notify 2 0 2006 01 14 change support precision coordinate 1 0 2003 12 01 derive 5 4b1 composite figure extend figure implement composite figure child thi figure compose see #add see #remove child link list figure child link list figure cache draw bound rectangle2 d draw bound cache layout bound rectangle2 d bound layout determine how composite figure should lay out graphically layout layout handle figure change child child handler child handler child handler thi child handler implement figure listener undoable edit listener composite figure owner child handler composite figure owner thi owner owner figure request remove figure e owner remove e get figure figure remove figure evt owner remove evt get figure figure change figure e owner change owner change owner fire figure change e owner change figure add figure e figure attribute change figure e figure area invalidate figure e owner change owner fire area invalidate e get invalidate area undoable edit happen undoable edit e owner fire undoable edit happen e get edit create instance composite figure collection handle create handle detail level detail level 0 create handle 0 link list handle handle link list handle figure child child handle add child create handle detail level 1 handle link list handle handle link list handle handle add figure figure add get child count figure add index figure figure change basic add index figure get figure add notify get change add collection figure figure change figure f figure basic add get child count f get f add notify get change basic add figure figure basic add get child count figure basic add index figure figure child add index figure figure add figure listener child handler figure add undoable edit listener child handler basic add collection figure figure figure f figure basic add get child count f add notify add notify figure child child child add notify remove notify copy child collection avoid concurrent modification figure child link list figure child child remove notify remove notify remove figure figure index child index figure index 1 change basic remove child index get figure remove notify get change figure remove child index change figure remove basic remove child index get remove remove notify get change remove basic remove figure figure index child index figure index 1 basic remove child index figure basic remove child index figure figure child remove index figure remove figure listener child handler figure remove undoable edit listener child handler figure remove child see #add remove child change child size 0 figure f basic remove child child size 1 get f add notify get change basic remove child child size 0 figure f basic remove child child size 1 send figure back composite figure figure thi composite figure synchronize send back figure figure child remove figure child add 0 figure figure invalidate send figure front figure synchronize send front figure figure child remove figure child add figure figure invalidate transform figure basic transform affine transform tx figure f child f basic transform tx invalidate bound basic set bound point2 d anchor point2 d rectangle2 d old bound get bound rectangle2 d bound rectangle2 d math anchor x x math anchor y y math ab anchor x x math ab anchor y y sx bound width old bound width sy bound height old bound height affine transform tx affine transform tx translate old bound x old bound y na n sx na n sy sx 1d || sy 1d sx 0 0001 sy 0 0001 basic transform tx tx set identity tx scale sx sy basic transform tx tx set identity tx translate bound x bound y basic transform tx undoable edit happen undoable edit e fire undoable edit happen e get edit list figure get child collection unmodifiable list child get child count child size figure get child index child get index iterator iterate z order front back over child list figure get child front back child ? link list figure reverse list figure child set attribute attribute key value change figure child child child set attribute value change basic set attribute attribute key value figure child child child basic set attribute value get attribute attribute key contain point2 d p get draw bound contain p figure child get child front back child visible child contain p figure find figure inside point2 d p get draw bound contain p figure found figure child get child front back child visible found child find figure inside p found found figure find child point2 d p get bound contain p figure found figure child get child front back child visible child contain p child find child index point2 d p figure child find child p child ? 1 child index child get layout which encapsulate layout algorithm thi figure typically layout access child component thi figure arrange their graphical presentation layout strategy thi figure layout get layout layout layout algorithm define how child component should lay out relation each other task layout child component presentation delegate layout which plug at runtime layout get layout rectangle2 d bound get bound point2 d p point2 d bound x bound y rectangle2 d r get layout layout thi p p basic set bound point2 d r x r y point2 d r x + r width r y + r height invalidate bound set layout which encapsulate layout algorithm thi figure typically layout access child component thi figure arrange their graphical presentation good idea set layout protect initialize so recreate graphical composite figure read restore storable input stream layout encapsulation layout algorithm set layout layout layout thi layout layout dimension2 d get prefer size thi layout rectangle2 d r layout calculate layout thi get start point get end point dimension2 d r width r height get prefer size rectangle2 d get figure draw bound draw bound figure child get child front back child visible rectangle2 d child bound child get draw bound child bound empty draw bound draw bound child bound draw bound add child bound draw bound ? rectangle2 d 0 0 1 1 rectangle2 d draw bound clone rectangle2 d get bound bound figure child get child front back child visible bound bound child get bound bound add child get bound bound ? rectangle2 d 0 0 1 1 rectangle2 d bound clone draw figure graphics2 d g figure child child child visible child draw g connector visible draw connector g protect draw connector graphics2 d g composite figure clone composite figure composite figure clone child handler child handler child link list figure figure thi child thi child figure child figure thi child clone child add child child add figure listener child handler child add undoable edit listener child handler protect invalidate bound bound draw bound collection figure get decomposition link list figure list link list figure list add thi list add get child list read dom input i o open element child i 0 i get element count i++ add figure read i close element write dom output out i o out open element child figure child get child out write child out close element map attribute key get attribute hash map attribute key restore geometry link list list link list geometry index 0 geom list get child index restore geom index++ invalidate bound get restore data link list list link list figure child child list add child get restore data list change change get change depth 1 figure child child child change change get change depth 1 figure child child child change change invalidate invalidate invalidate bound protect validate validate layout invalidate bound remove attribute attribute key key nothing ha attribute attribute key key 