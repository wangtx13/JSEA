xml nano xml $ revision 1 5 $ $ date 2002 02 03 21 19 38 $ $ name r e l e a s e 2 2 1 $ is part of nano xml 2 copyright c 2000 2002 marc de scheemaeck all right reserve software is provide a is without any express or imply warranty in no event will the author be hold liable any damage arise from the use of software permission is grant to anyone to use software any purpose include commercial application and to alter it and redistribute it freely subject to the following restriction 1 the origin of software must not be misrepresent you must not claim that you write the original software you use software in a product an acknowledgment in the product documentation would be appreciate but is not require 2 alter source version must be plainly mark a such and must not be misrepresent a being the original software 3 notice may not be remove or alter from any source distribution net n3 nanoxml io i o io reader io reader utility nano xml author marc de scheemaeck $ name r e l e a s e 2 2 1 $ $ revision 1 5 $ xml skip the remainder of a comment it is assume that lt is already read reader the reader io i o an occur reading the data skip comment i xml reader reader i o xml parse reader read xml expect input reader get reader get line nr dash read 0 ch reader read ch dash read++ dash read 2 dash read 0 skip the remainder of the current xml tag reader the reader io i o an occur reading the data skip tag i xml reader reader i o xml parse level 1 level 0 ch reader read ch ++level level scan a will contain the reader the reader the io i o an occur reading the data scan buffer i xml reader reader i o xml parse xml check literal reader u b l i c xml skip whitespace reader append xml scan reader \0 xml skip whitespace reader xml scan reader \0 scan a reader the reader the io i o an occur reading the data scan i xml reader reader i o xml parse xml check literal reader y s t e m xml skip whitespace reader xml scan reader \0 retrieve an identifier from the data reader the reader io i o an occur reading the data scan identifier i xml reader reader i o xml parse buffer result buffer ch reader read ch || ch || ch || ch || ch a ch z || ch a ch z || ch 0 ch 9 || ch \u007 e result append ch reader unread ch result to retrieve a delimit from the data reader the reader entity the escape character amp or % entity resolv the entity resolv io i o an occur reading the data scan i xml reader reader entity i xml entity resolv entity resolv i o xml parse buffer result buffer starting level reader get stream level delim reader read delim \ delim xml expect input reader get reader get line nr delimit str xml read reader entity ch str at 0 ch entity str at 1 # result append xml process literal str xml process entity str reader entity resolv ch reader unread ch str xml read reader str at 1 # result append xml process literal str result append str reader get stream level starting level ch delim ch 9 || ch 10 || ch 13 result append result append ch result append ch result to process an entity entity the entity reader the reader entity resolv the entity resolv io i o an occur reading the data process entity entity i xml reader reader i xml entity resolv entity resolv i o xml parse entity entity substring 1 entity length 1 reader entity reader entity resolv get entity reader entity entity reader xml invalid entity reader get reader get line nr entity external entity entity resolv is external entity entity reader start stream entity reader external entity process a character literal entity the entity io i o an occur reading the data process literal entity i o xml parse entity at 2 x entity entity substring 3 entity length 1 parse entity 16 entity entity substring 2 entity length 1 parse entity 10 skip whitespace from the reader reader the reader buffer where to put the whitespace the whitespace doe not have to be store io i o an occur reading the data skip whitespace i xml reader reader buffer buffer i o ch buffer ch reader read ch || ch || ch ch reader read ch ch ch ch buffer append buffer append reader unread ch read a character from the reader reader the reader entity the escape character amp or % use to indicate an entity the character or an entity expression like e g amp lt io i o an occur reading the data read i xml reader reader entity i o xml parse ch reader read buffer buf buffer buf append ch ch entity ch ch reader read buf append ch buf to read a character from the reader disallow entity reader the reader entity the escape character amp or % use to indicate an entity read i xml reader reader entity i o xml parse str xml read reader entity ch str at 0 ch entity xml unexpect entity reader get reader get line nr str ch the data start with i literal i enough char are read to determine result reader the reader literal the literal to check io i o an occur reading the data check literal i xml reader reader literal i o xml parse i 0 i literal length i++ reader read literal at i an xml parse to indicate that an expect is not encounter the of the data source line nr the line number in the data source expect the that is expect expect input line nr expect xml parse xml parse line nr expect + expect an xml parse to indicate that an entity could not be resolve the of the data source line nr the line number in the data source entity the name of the entity invalid entity line nr entity xml parse xml parse line nr invalid entity ` + entity + an xml parse to indicate that an entity reference is unexpect at point the of the data source line nr the line number in the data source entity the name of the entity unexpect entity line nr entity xml parse xml parse line nr no entity reference is expect here + entity + an xml parse to indicate that a c d a t a section is unexpect at point the of the data source line nr the line number in the data source unexpect c d a t a line nr xml parse xml parse line nr no c d a t a section is expect here an xml parse to indicate that a is not expect at point the of the data source line nr the line number in the data source unexpect the that is unexpect invalid input line nr unexpect xml parse xml parse line nr invalid input + unexpect an xml parse to indicate that the closing tag of an element doe not match the opening tag the of the data source line nr the line number in the data source expect name the name of the opening tag wrong name the name of the closing tag wrong closing tag line nr expect name wrong name xml parse xml parse line nr closing tag doe not match opening tag ` + wrong name + ` + expect name + an xml parse to indicate that extra data is encounter in a closing tag the of the data source line nr the line number in the data source closing tag not empty line nr xml parse xml parse line nr closing tag must be empty an xml validation to indicate that an element is miss the of the data source line nr the line number in the data source parent element name the name of the parent element miss element name the name of the miss element miss element line nr parent element name miss element name xml validation xml validation xml validation m i s s i n g e l e m e n t line nr miss element name attribute name attribute value element + parent element name + expect to have a + miss element name an xml validation to indicate that an element is unexpect the of the data source line nr the line number in the data source parent element name the name of the parent element unexpect element name the name of the unexpect element unexpect element line nr parent element name unexpect element name xml validation xml validation xml validation u n e x p e c t e d e l e m e n t line nr unexpect element name attribute name attribute value unexpect + unexpect element name + in a + parent element name an xml validation to indicate that an attribute is miss the of the data source line nr the line number in the data source element name the name of the element attribute name the name of the miss attribute miss attribute line nr element name attribute name xml validation xml validation xml validation m i s s i n g a t t r i b u t e line nr element name attribute name attribute value element + element name + expect an attribute name + attribute name an xml validation to indicate that an attribute is unexpect the of the data source line nr the line number in the data source element name the name of the element attribute name the name of the unexpect attribute unexpect attribute line nr element name attribute name xml validation xml validation xml validation u n e x p e c t e d a t t r i b u t e line nr element name attribute name attribute value element + element name + do not expect an attribute + name + attribute name an xml validation to indicate that an attribute ha an invalid value the of the data source line nr the line number in the data source element name the name of the element attribute name the name of the attribute attribute value the value of that attribute invalid attribute value line nr element name attribute name attribute value xml validation xml validation xml validation a t t r i b u t e w i t h i n v a l v a l u e line nr element name attribute name attribute value invalid value attribute + attribute name an xml validation to indicate that a # p c d a t a element wa miss the of the data source line nr the line number in the data source parent element name the name of the parent element miss p c data line nr parent element name xml validation xml validation xml validation m i s s i n g p c d a t a line nr element name attribute name attribute value miss # p c d a t a in element + parent element name an xml validation to indicate that a # p c d a t a element wa unexpect the of the data source line nr the line number in the data source parent element name the name of the parent element unexpect p c data line nr parent element name xml validation xml validation xml validation u n e x p e c t e d p c d a t a line nr element name attribute name attribute value unexpect # p c d a t a in element + parent element name an xml validation the of the data source line nr the line number in the data source message the message element name the name of the element attribute name the name of the attribute attribute value the value of that attribute validation line nr message element name attribute name attribute value xml validation xml validation xml validation m i s c e r r o r line nr element name attribute name attribute value message 