# bezi figure 2 1 1 2006 06 08 copyright c 1996 2006 by the original author of jhotdraw and all it contributor jhotdraw org all right reserve software is the confidential and proprietary information of jhotdraw org confidential information you shall not disclose such confidential information and shall use it only in accordance with the term of the license agreement you enter into with jhotdraw org org jhotdraw draw org jhotdraw event geom undo io org jhotdraw draw attribute key org jhotdraw geom org jhotdraw xml dom input org jhotdraw xml dom output a bezi figure can be use to draw arbitrary shape using a bezi path it can be use to draw an open path or a close shape 2 1 1 2006 06 08 fix cap drawing 2 1 2006 04 21 improve cap drawing 2 0 2006 01 14 change to support coordinate 1 0 march 14 2004 author wern randelshof bezi figure attribute figure attribute key c l o s e d attribute key close the bezi path bezi path path the cap path bezi path is derive from variable path we cache it to increase the drawing speed of the figure bezi path cap path create a instance bezi figure create a instance bezi figure is close path bezi path c l o s e d set is close path set close is close d r a w i n g s h a p e a n d b o u n d s a t t r i b u t e s e d i t i n g c o n n e c t i n g the figure connector the specify location by a chop diamond connector is see chop diamond connector connector find connector point2 d p connection figure prototype chop bezi connector connector find compatible connector connector c is start chop bezi connector c o m p o s i t e f i g u r e s c l o n i n g e v e n t h a n d l i n g draw stroke graphics2 d g is close grow attribute key get perpendicular draw growth grow 0d g draw path grow stroke g grow stroke grow attribute key get stroke total width s t r o k e m i t e r l i m i t f a c t o r get g draw g create stroke shape path g draw get cap path draw cap g draw cap graphics2 d g get point count 1 s t a r t d e c o r a t i o n get bezi path cp get cap path point2 d p1 path get 0 0 point2 d p2 cp get 0 0 p2 equal p1 p2 path get 1 0 s t a r t d e c o r a t i o n get draw g p1 p2 e n d d e c o r a t i o n get bezi path cp get cap path point2 d p1 path get path size 1 0 point2 d p2 cp get path size 1 0 p2 equal p1 p2 path get path size 2 0 e n d d e c o r a t i o n get draw g p1 p2 draw fill graphics2 d g is close grow attribute key get perpendicular fill growth grow 0d g fill path grow stroke g grow stroke grow attribute key get stroke total width s t r o k e m i t e r l i m i t f a c t o r get g fill g create stroke shape path contain point2 d p is close grow attribute key get perpendicular hit growth grow 0d path contain p grow stroke g grow stroke grow attribute key get stroke total width s t r o k e m i t e r l i m i t f a c t o r get g create stroke shape path contain p tolerance math max 2f attribute key get stroke total width 2 get cap path outline contain p tolerance s t a r t d e c o r a t i o n get bezi path cp get cap path point2 d p1 path get 0 0 point2 d p2 cp get 0 0 f i x m e check here cap path contain the point geom line contain point p1 x p1 y p2 x p2 y p x p y tolerance e n d d e c o r a t i o n get bezi path cp get cap path point2 d p1 path get path size 1 0 point2 d p2 cp get path size 1 0 f i x m e check here cap path contain the point geom line contain point p1 x p1 y p2 x p2 y p x p y tolerance check figure can be connect by fill bezi figure can be connect can connect is close collection handle create handle detail level link list handle handle link list handle detail level 0 box handle kit add box handle handle handle add bezi scale handle 1 i 0 n path size i n i++ handle add bezi node handle i handle rectangle2 d get bound rectangle2 d bound path get bounds2 d make sure bound are not empty bound width math max 1 bound width bound height math max 1 bound height bound rectangle2 d get figure draw bound rectangle2 d r get figure draw bound get node count 1 s t a r t d e c o r a t i o n get point2 d p1 get point 0 0 point2 d p2 get point 1 0 r add s t a r t d e c o r a t i o n get get draw bound p1 p2 e n d d e c o r a t i o n get point2 d p1 get point get node count 1 0 point2 d p2 get point get node count 2 0 r add e n d d e c o r a t i o n get get draw bound p1 p2 r validate validate path invalidate path invalidate cap path a clone of the bezi path of figure bezi path get bezi path bezi path path clone point2 d get point on path relative flatness path get point on path relative flatness set the bezi path without cloning and without firing event basic set bezi path bezi path value path value set close value is close is close get attribute c l o s e d set close value c l o s e d set value basic set attribute attribute key key value key c l o s e d path set close value basic set attribute key value basic set bound point2 d anchor point2 d basic set start point anchor basic set end point invalidate basic transform affine transform tx path transform tx invalidate invalidate invalidate path invalidate path invalidate cap path invalidate cap path cap path a path which is cap path at the end to prevent it from drawing under the end cap bezi path get cap path cap path cap path bezi path path clone is close cap path set close cap path size 1 s t a r t d e c o r a t i o n get bezi path node p0 cap path get 0 bezi path node p1 cap path get 1 point2 d pp p0 get mask bezi path c2 m a s k 0 pp p0 get control point 2 p1 get mask bezi path c1 m a s k 0 pp p1 get control point 1 pp p1 get control point 0 radius s t a r t d e c o r a t i o n get get decoration radius line length geom length p0 get control point 0 pp cap path set 0 0 geom cap pp p0 get control point 0 math min radius line length e n d d e c o r a t i o n get bezi path node p0 cap path get cap path size 1 bezi path node p1 cap path get cap path size 2 point2 d pp p0 get mask bezi path c1 m a s k 0 pp p0 get control point 1 p1 get mask bezi path c2 m a s k 0 pp p1 get control point 2 pp p1 get control point 0 radius e n d d e c o r a t i o n get get decoration radius line length geom length p0 get control point 0 pp cap path set cap path size 1 0 geom cap pp p0 get control point 0 math min radius line length cap path invalidate path cap path layout add a control point add node bezi path node p add node get node count p add a node to the list of point add node index bezi path node p bezi path node point bezi path node p will change basic add node index point layout change fire undoable edit happen undoable edit get presentation name punkt einf\u00fcgen undo cannot undo undo will change basic remove node index change redo cannot undo redo will change basic add node index point change add a control point basic add node bezi path node p path add p invalidate add a control point basic add node index bezi path node p path add index p set a control point set node index bezi path node p will change bezi path node old value path get index bezi path node value bezi path node p basic set node index value change fire undoable edit happen bezi node edit index old value value set a control point basic set node index bezi path node p path set index p get a control point bezi path node get node index bezi path node path get index clone convenience getting the point coordinate of the first control point of the specify node point2 d get point index path get index get control point 0 get the point coordinate of a control point point2 d get point index coord path get index get control point coord set the point coordinate of a control point set point index coord point2 d p will change basic set point index coord p change x x x fire undoable edit event set the point coordinate of control point 0 at the specify node basic set point index point2 d p bezi path node node path get index dx p x node x 0 dy p y node y 0 i 0 i node x length i++ node x i + dx node y i + dy invalidate set the point coordinate of a control point basic set point index coord point2 d p bezi path node cp bezi path node path get index cp set control point coord p basic set node index cp convenience setting the point coordinate of the start point basic set start point point2 d p basic set point 0 p convenience setting the point coordinate of the end point basic set end point point2 d p basic set point get point count 1 p convenience getting the start point point2 d get start point get point 0 0 convenience getting the end point point2 d get end point get point get node count 1 0 find a control point index 1 no control point could be found f i x m e move to bezi path find node point2 d p bezi path tp path i 0 i tp size i++ bezi path node p2 tp get i p2 x 0 p x p2 y 0 p y i 1 remove all point remove all node will change basic remove all node change remove the point2 d at the specify index remove node index bezi path node old point bezi path node path get index will change basic remove node index layout change fire undoable edit happen undoable edit get presentation name punkt entfernen undo cannot undo undo will change basic add node index old point change redo cannot undo redo basic remove node index change get the segment of the polyline that is hit by the given point2 d the index of the segment or 1 no segment wa hit x x x move to bezi path find segment point2 d find fixme use path iterator point2 d p1 p2 i 0 n get node count 1 i n i++ p1 path get i 0 p2 path get i+1 0 geom line contain point p1 x p1 y p2 x p2 y find x find y 3d i 1 join two segment into one the given point2 d hit a node of the polyline the two segment be join x x x move to bezi path basic join segment point2 d join i find segment join i 1 i 1 remove node i split the segment at the given point2 d a segment wa hit the index of the segment or 1 no segment wa hit x x x move to bezi path basic split segment point2 d split i find segment split i 1 add node i + 1 bezi path node split i+1 remove the point2 d at the specify index basic remove node index path remove index remove the point2 d at the specify index basic remove all node path clear get the node count get node count path size get the point count get point count path size bezi figure clone bezi figure that bezi figure clone that path bezi path path clone that invalidate that restore to geometry path set to bezi path geometry get restore data path clone point2 d chop point2 d p is close grow attribute key get perpendicular hit growth grow 0d path chop p grow stroke g grow stroke grow attribute key get stroke total width s t r o k e m i t e r l i m i t f a c t o r get geom chop g create stroke shape path p path chop p point2 d get center path get center point2 d get outermost point path get path index of outermost node get control point 0 join two segment into one the given point2 d hit a node of the polyline the two segment be join basic join segment point2 d join tolerance path join segment join tolerance split the segment at the given point2 d a segment wa hit the index of the segment or 1 no segment wa hit basic split segment point2 d split tolerance path split segment split tolerance handle a mouse click handle mouse click point2 d p mouse event evt drawing view view evt get click count 2 view get handle detail level 1 will change index basic split segment p 5f view get scale factor index 1 bezi path node node get node index fire undoable edit happen undoable edit redo cannot redo redo will change basic add node index node change undo cannot undo undo will change basic remove node index change change write dom output out i o write point out write attribute out write point dom output out i o out open element point is close out add attribute close i 0 n get node count i n i++ bezi path node node get node i out open element p node mask 0 out add attribute mask node mask node keep colinear out add attribute colinear out add attribute x node x 0 out add attribute y node y 0 node x 1 node x 0 || node y 1 node y 0 out add attribute c1x node x 1 out add attribute c1y node y 1 node x 2 node x 0 || node y 2 node y 0 out add attribute c2x node x 2 out add attribute c2y node y 2 out close element out close element override read dom input in i o read point in read attribute in read point dom input in i o path clear in open element point set close in get attribute close i 0 n in get element count p i n i++ in open element p i bezi path node node bezi path node in get attribute mask 0 in get attribute x 0d in get attribute y 0d in get attribute c1x in get attribute x 0d in get attribute c1y in get attribute y 0d in get attribute c2x in get attribute x 0d in get attribute c2y in get attribute y 0d node keep colinear in get attribute colinear path add node path invalidate path in close element in close element 