# figure 3 3 2006 06 17 copyright c 1996 2006 by the original author of jhotdraw and all it contributor jhotdraw org all right reserve software is the confidential and proprietary information of jhotdraw org confidential information you shall not disclose such confidential information and shall use it only in accordance with the term of the license agreement you enter into with jhotdraw org org jhotdraw draw org jhotdraw event event font geom undo io org jhotdraw geom figure provide the functionality manage listener a figure author wern randelshof 3 3 rework 3 2 2006 01 05 add get change depth 3 0 2006 01 20 rework j2 s e 1 5 1 0 2003 12 01 derive from jhotdraw 5 4b1 figure figure event listener list listener list event listener list is connector visible connection figure courting connection drawing drawing is interactive is visible figure decorator is draw decorator first we increase number on each invocation of will change and decrease it on each invocation of change change depth 0 create a instance figure d r a w i n g s h a p e a n d b o u n d s a t t r i b u t e s e d i t i n g c o n n e c t i n g c o m p o s i t e f i g u r e s c l o n i n g e v e n t h a n d l i n g add figure listener figure listener l listener list add figure listener l remove figure listener figure listener l listener list remove figure listener l add undoable edit listener undoable edit listener l listener list add undoable edit listener l remove undoable edit listener undoable edit listener l listener list remove undoable edit listener l add notify drawing d drawing d fire figure add remove notify drawing d fire figure remove drawing drawing get drawing drawing get lock get drawing ? get drawing get lock set draw decorator first value is draw decorator first value is draw decorator first is draw decorator first notify all listener list that have register interest notification on event type fire area invalidate fire area invalidate get draw bound notify all listener list that have register interest notification on event type fire area invalidate rectangle2 d invalidate area listener list get listener count 0 figure event event notify all listener that have register interest guarantee to a non listener listener list get listener list process the listener last to first notify those that are interest in event i listener length 2 i 0 i 2 listener i figure listener lazily create the event event event figure event invalidate area figure listener listener i+1 figure area invalidate event notify all listener list that have register interest notification on event type fire figure request remove listener list get listener count 0 figure event event notify all listener that have register interest guarantee to a non listener listener list get listener list process the listener last to first notify those that are interest in event i listener length 2 i 0 i 2 listener i figure listener lazily create the event event event figure event get bound figure listener listener i+1 figure request remove event notify all listener list that have register interest notification on event type fire figure add listener list get listener count 0 figure event event notify all listener that have register interest guarantee to a non listener listener list get listener list process the listener last to first notify those that are interest in event i listener length 2 i 0 i 2 listener i figure listener lazily create the event event event figure event get bound figure listener listener i+1 figure add event notify all listener list that have register interest notification on event type fire figure remove listener list get listener count 0 figure event event notify all listener that have register interest guarantee to a non listener listener list get listener list process the listener last to first notify those that are interest in event i listener length 2 i 0 i 2 listener i figure listener lazily create the event event event figure event get bound figure listener listener i+1 figure remove event fire figure change fire figure change get bound notify all listener list that have register interest notification on event type fire figure change rectangle2 d change area listener list get listener count 0 figure event event notify all listener that have register interest guarantee to a non listener listener list get listener list process the listener last to first notify those that are interest in event i listener length 2 i 0 i 2 listener i figure listener lazily create the event event event figure event change area figure listener listener i+1 figure change event fire figure change figure event event listener list get listener count 0 notify all listener that have register interest guarantee to a non listener listener list get listener list process the listener last to first notify those that are interest in event i listener length 2 i 0 i 2 listener i figure listener lazily create the event figure listener listener i+1 figure change event notify all listener list that have register interest notification on event type fire attribute change attribute key attribute old value value listener list get listener count 0 figure event event notify all listener that have register interest guarantee to a non listener listener list get listener list process the listener last to first notify those that are interest in event i listener length 2 i 0 i 2 listener i figure listener lazily create the event event event figure event attribute old value value figure listener listener i+1 figure attribute change event notify all listener list that have register interest notification on event type fire undoable edit happen undoable edit edit undoable edit event event listener list get listener count 0 notify all listener that have register interest guarantee to a non listener listener list get listener list process the listener last to first notify those that are interest in event i listener length 2 i 0 i 2 event event undoable edit event edit listener i undoable edit listener undoable edit listener listener i+1 undoable edit happen event set create handle hash set figure clone figure that figure clone that listener list event listener list that is connector visible that courting connection decorator that decorator figure decorator clone that clone not support e internal internal e get message init cause e figure basic clone hash map figure figure old to x x x delete me remap hash map figure figure old to collection handle create handle detail level link list handle handle link list handle detail level 0 box handle kit add box handle handle handle cursor get cursor point2 d p contain p cursor get predefin cursor cursor h a n d c u r s o r cursor get cursor set bound rectangle2 d bound set bound point2 d bound x bound y point2 d bound x + bound width bound y + bound height set bound point2 d anchor point2 d point2 d old anchor get start point point2 d old get end point old anchor equal anchor || old equal will change basic set bound anchor change fire undoable edit happen set bound edit old anchor old anchor check figure can be connect by figure can be connect can connect inform that a figure need to be redrawn invalidate fire area invalidate get draw bound is change change depth 0 get change depth change depth inform that a figure is about to change someth that affect the content of it display box will change change depth++ invalidate validate inform that a figure change the area of it display box change change depth 1 validate fire figure change get draw bound change depth 0 change depth transform the geometry of the figure transform affine transform tx will change basic transform tx fire undoable edit happen transform edit tx change move the figure is the that subclass override p is a basic operation which no event are fire basic transform affine transform ty the figure connector the specify location by a chop box connector is see chop box connector connector find connector point2 d p connection figure prototype chop box connector include figure figure figure figure find figure inside point2 d p contain p ? connector find compatible connector connector c is start chop box connector a collection of action which are present to the user in a popup menu p the collection may contain entry these entry are use interpret a separator in the popup menu collection action get action point2 d p collection empty list a specialize tool the given coordinate p no specialize tool is available tool get tool point2 d p handle a mouse click handle mouse click point2 d p mouse event evt drawing view view handle drop point2 d p collection figure drop figure drawing view view point2 d get end point rectangle2 d r get bound point2 d r x + r width r y + r height point2 d get start point rectangle2 d r get bound point2 d r x r y rectangle2 d get hit bound get bound dimension2 d get prefer size rectangle2 d r get bound dimension2 d r width r height remap map old to is interactive is interactive set interactive b is interactive b is visible is visible set visible value value is visible will change is visible value change set connector visible is visible connection figure connection will change is connector visible is visible courting connection connection change is connector visible is connector visible connection figure get courting connection courting connection collection figure get decomposition link list figure list link list figure list add list font render context get font render context font render context frc frc frc font render context affine transform option is text antialias option is fractional metric frc request remove fire figure request remove get layer 0 get tooltip point2 d p set decorator figure value will change decorator value decorator decorator basic set bound get start point get end point change figure get decorator decorator draw graphics2 d g is draw decorator first draw decorator g draw figure g draw figure g draw decorator g draw figure graphics2 d g draw decorator graphics2 d g decorator update decorator bound decorator draw g update decorator bound decorator point2 d sp get start point point2 d ep get end point insets2 d decorator inset attribute key d e c o r a t o r i n s e t s get sp x decorator inset left sp y decorator inset top ep x + decorator inset right ep y + decorator inset bottom decorator basic set bound sp ep rectangle2 d get draw bound rectangle2 d figure draw bound get figure draw bound decorator update decorator bound figure draw bound add decorator get draw bound figure draw bound rectangle2 d get figure draw bound to builder buf builder buf append get get name substring get get name last index of +1 buf append buf append hash buf to 