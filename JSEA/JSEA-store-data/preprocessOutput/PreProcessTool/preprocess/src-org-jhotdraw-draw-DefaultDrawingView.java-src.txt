# drawing view 3 0 2 2006 07 03 copyright c 1996 2006 by the original author of jhotdraw and all it contributor jhotdraw org all right reserve software is the confidential and proprietary information of jhotdraw org confidential information you shall not disclose such confidential information and shall use it only in accordance with the term of the license agreement you enter into with jhotdraw org ??? org jhotdraw draw org jhotdraw gui datatransf composite transferable org jhotdraw org jhotdraw undo datatransf geom color event io org jhotdraw app editable component org jhotdraw geom org jhotdraw xml org jhotdraw xml xml transferable drawing view author wern randelshof 3 0 2 2006 07 03 constrain must be a bound property 3 0 1 2006 06 11 draw handle when drawing view is the focus drawing view of the drawing editor 3 0 2006 02 17 rework to support multiple drawing view in a drawing editor 2 0 2006 01 14 change to support precision coordinate 1 0 2003 12 01 derive from jhotdraw 5 4b1 drawing view j component drawing view drawing listener handle listener editable component drawing drawing set figure dirty figure hash set figure set figure select figure hash set figure rainbow 0 link list handle selection handle link list handle handle secondary handle owner link list handle secondary handle link list handle handle are valid dimension prefer size scale factor 1 point2 d translate point2 d 0 0 detail level dom factory dom factory drawing editor editor constrain constrain grid constrain 1 1 j label empty drawing label ha permanent focus create instance drawing view init component set focusable add focus listener focus listener focus gain focus event e repaint focus lost focus event e repaint is call from within the constructor to initialize the form w a r n i n g n o t modify the content of is alway regenerate by the form editor init component g e n b e g i n init component button group1 button group set layout set background color 255 255 255 g e n e n d init component drawing get drawing drawing set get tool set empty drawing message value old value empty drawing label ? empty drawing label get text value empty drawing label empty drawing label j label value empty drawing label set horizontal alignment j label c e n t e r fire property change empty drawing message old value value repaint get empty drawing message empty drawing label ? empty drawing label get text paint component graphic gr graphics2 d g graphics2 d gr g set rendering hint rendering hint k e y a l p h a i n t e r p o l a t i o n rendering hint v a l u e a l p h a i n t e r p o l a t i o n q u a l i t y g set rendering hint rendering hint k e y a n t i a l i a s i n g rendering hint v a l u e a n t i a l i a s o n g set rendering hint rendering hint k e y a n t i a l i a s i n g rendering hint v a l u e a n t i a l i a s o f f g set rendering hint rendering hint k e y s t r o k e c o n t r o l rendering hint v a l u e s t r o k e n o r m a l i z e g set rendering hint rendering hint k e y s t r o k e c o n t r o l rendering hint v a l u e s t r o k e p u r e g set rendering hint rendering hint k e y f r a c t i o n a l m e t r i c s option is fractional metric ? rendering hint v a l u e f r a c t i o n a l m e t r i c s o n rendering hint v a l u e f r a c t i o n a l m e t r i c s o f f g set rendering hint rendering hint k e y f r a c t i o n a l m e t r i c s rendering hint v a l u e f r a c t i o n a l m e t r i c s o f f g set rendering hint rendering hint k e y i n t e r p o l a t i o n rendering hint v a l u e i n t e r p o l a t i o n b i c u b i c g set rendering hint rendering hint k e y r e n d e r i n g rendering hint v a l u e r e n d e r q u a l i t y g set rendering hint rendering hint k e y t e x t a n t i a l i a s i n g option is text antialias ? rendering hint v a l u e t e x t a n t i a l i a s o n rendering hint v a l u e t e x t a n t i a l i a s o f f draw background g draw grid g draw drawing g draw handle g draw tool g draw background graphics2 d g rainbow rainbow + 10 % 360 g set color color color h s bto r g b rainbow 360f 0 3f 1 0f position of the zero coordinate point on the view x translate x scale factor y translate y scale factor w get width h get height g set color get background g fill rect x y w x h y draw a gray background the area which is at negative view coordinate y 0 g set color color 0xf0f0f0 g fill rect 0 0 w y x 0 g set color color 0xf0f0f0 g fill rect 0 0 x h draw grid graphics2 d g constrain draw g draw drawing graphics2 d gr drawing drawing get figure count 0 empty drawing label empty drawing label set bound 0 0 get width get height empty drawing label paint gr graphics2 d g graphics2 d gr create affine transform tx g get transform tx translate translate x scale factor translate y scale factor tx scale scale factor scale factor g set transform tx drawing set font render context g get font render context drawing draw g g dispose draw handle graphics2 d g editor editor get focus view validate handle handle h get selection handle h draw g handle h get secondary handle h draw g draw tool graphics2 d g editor editor get view editor get tool editor get tool draw g set drawing drawing d drawing drawing remove drawing listener clear selection drawing d drawing drawing add drawing listener invalidate dimension invalidate get parent get parent validate repaint repaint rectangle2 d r rectangle vr drawing to view r vr grow 1 1 repaint vr area invalidate drawing event evt repaint evt get invalidate area invalidate dimension area invalidate handle event evt repaint evt get invalidate area invalidate dimension figure add drawing event evt repaint the whole drawing to remove the message label evt get drawing get figure count 1 repaint repaint evt get invalidate area invalidate dimension figure remove drawing event evt repaint the whole drawing to draw the message label evt get drawing get figure count 0 repaint repaint evt get invalidate area remove from selection evt get figure invalidate dimension invalidate invalidate dimension invalidate add a figure to the current selection add to selection figure figure select figure add figure invalidate handle fire selection change repaint add a collection of figure to the current selection add to selection collection figure figure select figure add all figure invalidate handle fire selection change repaint remove a figure from the selection remove from selection figure figure select figure remove figure invalidate handle fire selection change repaint a figure isn t select it is add to the selection otherwise it is remove from the selection toggle selection figure figure select figure contain figure select figure remove figure select figure add figure fire selection change invalidate handle repaint select all figure select all select figure clear select figure add all drawing get figure invalidate handle fire selection change repaint clear the current selection clear selection get selection count 0 select figure clear invalidate handle fire selection change repaint test wheth a given figure is select is figure select figure check figure select figure contain check figure get the current selection a a figure selection a figure selection can be cut copy paste collection figure get select figure collection unmodifiable set select figure get the number of select figure get selection count select figure size get the currently active selection handle list handle get selection handle validate handle collection unmodifiable list selection handle get the currently active secondary handle list handle get secondary handle validate handle collection unmodifiable list secondary handle invalidate the handle invalidate handle handle are valid handle are valid rectangle invalidate area handle handle selection handle handle remove handle listener invalidate area invalidate area handle get draw bound invalidate area add handle get draw bound handle dispose selection handle clear secondary handle clear select figure size 0 invalidate area repaint invalidate area 1 invalidate area repaint invalidate area validate handle repaint validate the handle validate handle handle are valid handle are valid rectangle invalidate area level detail level figure figure get select figure handle handle figure create handle level handle set view selection handle add handle handle add handle listener invalidate area invalidate area handle get bound invalidate area add handle get bound level 0 selection handle size 0 detail level level + 1 invalidate area repaint invalidate area find a handle at a given coordinate a handle no handle is found handle find handle point p validate handle handle handle reverse list handle get secondary handle handle contain p handle handle handle reverse list handle get selection handle handle contain p handle get compatible handle a collection contain the handle and all compatible handle collection handle get compatible handle handle master validate handle hash set figure owner hash set figure link list handle compatible handle link list handle owner add master get owner compatible handle add master handle handle get selection handle owner contain handle get owner handle is combinable with master owner add handle get owner compatible handle add handle compatible handle find a figure at a given coordinate a figure no figure is found figure find figure point p get drawing find figure view to drawing p collection figure find figure rectangle r get drawing find figure view to drawing r collection figure find figure within rectangle r get drawing find figure within view to drawing r add figure selection listener figure selection listener fsl listener list add figure selection listener fsl remove figure selection listener figure selection listener fsl listener list remove figure selection listener fsl notify all listener list that have register interest notification on event type fire selection change listener list get listener count 0 figure selection event event notify all listener that have register interest guarantee to a non listener listener list get listener list process the listener last to first notify those that are interest in event i listener length 2 i 0 i 2 listener i figure selection listener lazily create the event event event figure selection event figure selection listener listener i+1 selection change event handle request remove handle event e selection handle remove e get handle e get handle dispose invalidate handle validate handle repaint e get invalidate area invalidate dimension prefer size constrain get constrain constrain set constrain constrain value constrain old value constrain constrain value repaint fire property change constrain old value value side effect change view translation dimension get prefer size prefer size dimension2 d d dimension2 d drawing translate x 0 translate y 0 figure f drawing get figure rectangle2 d r f get draw bound d width math max d width r x + r width d height math max d height r y + r height translate x math min translate x r x translate y math min translate y r y prefer size dimension d width + 10 translate x scale factor d height + 10 translate y scale factor fire view transform change repaint prefer size convert drawing coordinate to view coordinate point drawing to view point2 d p point p x translate x scale factor p y translate y scale factor convert view coordinate to drawing coordinate point2 d view to drawing point p point2 d p x scale factor + translate x p y scale factor + translate y rectangle drawing to view rectangle2 d r rectangle r x translate x scale factor r y translate y scale factor r width scale factor r height scale factor rectangle2 d view to drawing rectangle r rectangle2 d r x scale factor + translate x r y scale factor + translate y r width scale factor r height scale factor container get container get scale factor scale factor set scale factor value old value scale factor scale factor value fire view transform change fire property change scale factor old value value invalidate dimension invalidate get parent get parent validate repaint fire view transform change handle handle selection handle handle view transform change handle handle secondary handle handle view transform change set handle detail level value detail level value invalidate handle repaint get handle detail level detail level handle request secondary handle handle event e e get handle secondary handle owner secondary handle owner e get handle secondary handle clear secondary handle add all secondary handle owner create secondary handle handle h secondary handle h set view h add handle listener repaint affine transform get drawing to view transform affine transform t affine transform t scale scale factor scale factor t translate translate x translate y t set dom factory dom factory value dom factory old value dom factory dom factory value fire property change dom factory old value value dom factory get dom factory dom factory copy dom factory get toolkit beep hash set figure to be copy hash set figure get select figure to be copy size 0 output stream out output stream nano xml lite dom output domo nano xml lite dom output dom factory domo open element drawing clip figure f get drawing get figure to be copy contain f domo write f domo close element domo save out data out to composite transferable transfer composite transferable transfer add xml transferable data application x drawing clip drawing clip transfer add xml transferable data text xml drawing clip toolkit get toolkit get clipboard set content transfer transfer i o e e print stack trace get toolkit beep cut dom factory get toolkit beep copy delete delete list figure to be delete list figure get select figure clear selection get drawing remove all to be delete paste dom factory get toolkit beep list figure to be select list figure data flavor flavor data flavor application x drawing clip drawing clip transferable transfer toolkit get toolkit get clipboard get content transfer is data flavor support flavor composite edit ce composite edit paste get drawing fire undoable edit happen ce figure f link list figure get select figure get drawing remove f input stream in in input stream transfer get transfer data flavor nano xml lite dom input domi nano xml lite dom input dom factory in domi open element drawing clip i 0 n domi get element count i n i++ figure f figure domi read i get drawing add f to be select add f in in close clear selection add to selection to be select get drawing fire undoable edit happen ce toolkit get toolkit beep throwable e e print stack trace duplicate collection figure sort get drawing sort get select figure hash map figure figure original to duplicate map hash map figure figure sort size clear selection drawing drawing get drawing list figure duplicate list figure sort size affine transform tx affine transform tx translate 5 5 figure f sort figure d figure f clone d basic transform tx duplicate add d original to duplicate map put f d drawing add d figure f duplicate f remap original to duplicate map add to selection duplicate remove notify drawing editor editor editor repaint add notify drawing editor editor editor editor repaint variable declaration not modify g e n b e g i n variable button group button group1 end of variable declaration g e n e n d variable 