# s v g util 1 0 july 8 2006 copyright c 1996 2006 by the original author of jhotdraw and all it contributor jhotdraw org all right reserve software is the confidential and proprietary information of jhotdraw org confidential information you shall not disclose such confidential information and shall use it only in accordance with the term of the license agreement you enter into with jhotdraw org org jhotdraw sample svg color geom io org jhotdraw draw org jhotdraw geom org jhotdraw sample svg figure org jhotdraw xml org jhotdraw draw attribute key s v g util author wern randelshof 1 0 july 8 2006 create s v g color i n h e r i t c o l o r color 0xffff00 color c u r r e n t c o l o r color 0xffff00 map color s v g c o l o r s link hash map color map link hash map color s v g 1 2 tiny color map put black color 0 0 0 map put green color 0 128 0 map put silver color 192 192 192 map put lime color 0 255 0 map put gray color 128 128 128 map put olive color 128 128 0 map put white color 255 255 255 map put yellow color 255 255 0 map put maroon color 128 0 0 map put navy color 0 0 128 map put red color 255 0 0 map put blue color 0 0 255 map put purple color 128 0 128 map put teal color 0 128 128 map put fuchsia color 255 0 255 map put aqua color 0 255 255 s v g 1 1 color map put aliceblue color 240 248 255 map put antiquewhite color 250 235 215 map put aqua color 0 255 255 map put aquamarine color 127 255 212 map put azure color 240 255 255 map put beige color 245 245 220 map put bisque color 255 228 196 map put black color 0 0 0 map put blanchedalmond color 255 235 205 map put blue color 0 0 255 map put blueviolet color 138 43 226 map put brown color 165 42 42 map put burlywood color 222 184 135 map put cadetblue color 95 158 160 map put chartreuse color 127 255 0 map put chocolate color 210 105 30 map put coral color 255 127 80 map put cornflowerblue color 100 149 237 map put cornsilk color 255 248 220 map put crimson color 220 20 60 map put cyan color 0 255 255 map put darkblue color 0 0 139 map put darkcyan color 0 139 139 map put darkgoldenrod color 184 134 11 map put darkgray color 169 169 169 map put darkgreen color 0 100 0 map put darkgrey color 169 169 169 map put darkkhaki color 189 183 107 map put darkmagenta color 139 0 139 map put darkolivegreen color 85 107 47 map put darkorange color 255 140 0 map put darkorchid color 153 50 204 map put darkr color 139 0 0 map put darksalmon color 233 150 122 map put darkseagreen color 143 188 143 map put darkslateblue color 72 61 139 map put darkslategray color 47 79 79 map put darkslategrey color 47 79 79 map put darkturquoise color 0 206 209 map put darkviolet color 148 0 211 map put deeppink color 255 20 147 map put deepskyblue color 0 191 255 map put dimgray color 105 105 105 map put dimgrey color 105 105 105 map put dodgerblue color 30 144 255 map put firebrick color 178 34 34 map put floralwhite color 255 250 240 map put forestgreen color 34 139 34 map put fuchsia color 255 0 255 map put gainsboro color 220 220 220 map put ghostwhite color 248 248 255 map put gold color 255 215 0 map put goldenrod color 218 165 32 map put gray color 128 128 128 map put grey color 128 128 128 map put green color 0 128 0 map put greenyellow color 173 255 47 map put honeydew color 240 255 240 map put hotpink color 255 105 180 map put indianr color 205 92 92 map put indigo color 75 0 130 map put ivory color 255 255 240 map put khaki color 240 230 140 map put lavender color 230 230 250 map put lavenderblush color 255 240 245 map put lawngreen color 124 252 0 map put lemonchiffon color 255 250 205 map put lightblue color 173 216 230 map put lightcoral color 240 128 128 map put lightcyan color 224 255 255 map put lightgoldenrodyellow color 250 250 210 map put lightgray color 211 211 211 map put lightgreen color 144 238 144 map put lightgrey color 211 211 211 map put lightpink color 255 182 193 map put lightsalmon color 255 160 122 map put lightseagreen color 32 178 170 map put lightskyblue color 135 206 250 map put lightslategray color 119 136 153 map put lightslategrey color 119 136 153 map put lightsteelblue color 176 196 222 map put lightyellow color 255 255 224 map put lime color 0 255 0 map put limegreen color 50 205 50 map put linen color 250 240 230 map put magenta color 255 0 255 map put maroon color 128 0 0 map put mediumaquamarine color 102 205 170 map put mediumblue color 0 0 205 map put mediumorchid color 186 85 211 map put mediumpurple color 147 112 219 map put mediumseagreen color 60 179 113 map put mediumslateblue color 123 104 238 map put mediumspringgreen color 0 250 154 map put mediumturquoise color 72 209 204 map put mediumvioletr color 199 21 133 map put midnightblue color 25 25 112 map put mintcream color 245 255 250 map put mistyrose color 255 228 225 map put moccasin color 255 228 181 map put navajowhite color 255 222 173 map put navy color 0 0 128 map put oldlace color 253 245 230 map put olive color 128 128 0 map put olivedrab color 107 142 35 map put orange color 255 165 0 map put oranger color 255 69 0 map put orchid color 218 112 214 map put palegoldenrod color 238 232 170 map put palegreen color 152 251 152 map put paleturquoise color 175 238 238 map put palevioletr color 219 112 147 map put papayawhip color 255 239 213 map put peachpuff color 255 218 185 map put peru color 205 133 63 map put pink color 255 192 203 map put plum color 221 160 221 map put powderblue color 176 224 230 map put purple color 128 0 128 map put red color 255 0 0 map put rosybrown color 188 143 143 map put royalblue color 65 105 225 map put saddlebrown color 139 69 19 map put salmon color 250 128 114 map put sandybrown color 244 164 96 map put seagreen color 46 139 87 map put seashell color 255 245 238 map put sienna color 160 82 45 map put silver color 192 192 192 map put skyblue color 135 206 235 map put slateblue color 106 90 205 map put slategray color 112 128 144 map put slategrey color 112 128 144 map put snow color 255 250 250 map put springgreen color 0 255 127 map put steelblue color 70 130 180 map put tan color 210 180 140 map put teal color 0 128 128 map put thistle color 216 191 216 map put tomato color 255 99 71 map put turquoise color 64 224 208 map put violet color 238 130 238 map put wheat color 245 222 179 map put white color 255 255 255 map put whitesmoke color 245 245 245 map put yellow color 255 255 0 map put yellowgreen color 154 205 50 s v g 1 2 tiny color map put activebord u i manager get color active caption border map put activecaption u i manager get color active caption map put appworkspace u i manager get color window map put background u i manager get color desktop map put buttonface u i manager get color control map put buttonhighlight u i manager get color control highlight map put buttonshadow u i manager get color control shadow map put buttontext u i manager get color control text map put captiontext u i manager get color active caption text map put graytext u i manager get color text inactive text map put highlight u i manager get color text highlight map put highlighttext u i manager get color text highlight text map put inactivebord u i manager get color inactive caption border map put inactivecaption u i manager get color inactive caption map put inactivecaptiontext u i manager get color inactive caption text map put infobackground u i manager get color info map put infotext u i manager get color info text map put menu u i manager get color menu map put menutext u i manager get color menu text map put scrollbar u i manager get color scrollbar map put threeddarkshadow u i manager get color control dk shadow map put threedface u i manager get color control map put threedhighlight u i manager get color control highlight map put threedlightshadow u i manager get color control lt highlight map put threedshadow u i manager get color control shadow map put window u i manager get color window map put windowframe u i manager get color window border map put windowtext u i manager get color window text s v g c o l o r s map prevent instance creation s v g affine transform get transform dom input in attribute name i o get transform in get attribute attribute name affine transform get transform str i o affine transform t affine transform str stream tokeniz tt stream tokeniz reader str tt reset syntax tt word char a z tt word char a z tt word char 128 + 32 255 tt whitespace char 0 tt whitespace char tt parse number tt next token stream tokeniz t t e o f tt ttype stream tokeniz t t w o r d i o illegal transform +str type tt sval tt next token i o not found in transform +str type equal matrix m 6 i 0 i 6 i++ tt next token stream tokeniz t t n u m b e r i o matrix value +i+ not found in transform +str+ token +tt ttype+ +tt sval tt next token stream tokeniz t t w o r d tt sval start with e mantissa tt nval tt nval value of tt nval + tt sval tt push back m i tt nval t concatenate affine transform m type equal translate tx ty tt next token stream tokeniz t t n u m b e r i o x translation value not found in transform +str tx tt nval tt next token stream tokeniz t t n u m b e r ty tt nval tt push back ty 0 t translate tx ty type equal scale sx sy tt next token stream tokeniz t t n u m b e r i o x scale value not found in transform +str sx tt nval tt next token stream tokeniz t t n u m b e r sy tt nval tt push back sy sx t scale sx sy type equal rotate angle cx cy tt next token stream tokeniz t t n u m b e r i o angle value not found in transform +str angle tt nval tt next token stream tokeniz t t n u m b e r cx tt nval tt next token stream tokeniz t t n u m b e r i o y center value not found in transform +str cy tt nval tt push back cx cy 0 t rotate angle math p i 180d cx math p i 180d cy math p i 180d type equal skew x angle tt next token stream tokeniz t t n u m b e r i o skew angle not found in transform +str angle tt nval t concatenate affine transform 1 0 math tan angle math p i 180 1 0 0 type equal skew y angle tt next token stream tokeniz t t n u m b e r i o skew angle not found in transform +str angle tt nval t concatenate affine transform 1 math tan angle math p i 180 0 1 0 0 i o unknown transform +type+ in +str tt next token i o not found in transform +str t get dimension dom input in attribute name i o get dimension value in in get attribute attribute name 0 get dimension value dom input in str i o scale factor 1d str || str length 0 0d str end with % str str substring 0 str length 1 str end with px str str substring 0 str length 2 str end with pt str str substring 0 str length 2 scale factor 1 25 str end with pc str str substring 0 str length 2 scale factor 15 str end with mm str str substring 0 str length 2 scale factor 3 543307 str end with cm str str substring 0 str length 2 scale factor 35 43307 str end with in str str substring 0 str length 2 scale factor 90 str end with em str str substring 0 str length 2 list map style list map list value in get inherit attribute style v value style add get style v value get inherit attribute font size in style value value end with em scale factor get dimension value in value parse str scale factor list bezi path get path dom input in attribute name i o from path data in get attribute attribute name set path dom output out attribute name bezi path path out add attribute attribute name to path data path to path data bezi path path builder buf builder path size 0 nothing to path size 1 bezi path node current path get 0 buf append m buf append current x 0 buf append buf append current y 0 buf append l buf append current x 0 buf append buf append current y 0 + 1 bezi path node previou bezi path node current previou current path get 0 buf append m buf append current x 0 buf append buf append current y 0 i 1 n path size i n i++ previou current current path get i previou mask bezi path c2 m a s k 0 current mask bezi path c1 m a s k 0 buf append l buf append current x 0 buf append buf append current y 0 buf append q buf append current x 1 buf append buf append current y 1 buf append buf append current x 0 buf append buf append current y 0 current mask bezi path c1 m a s k 0 buf append q buf append current x 2 buf append buf append current y 2 buf append buf append current x 0 buf append buf append current y 0 buf append c buf append previou x 2 buf append buf append previou y 2 buf append buf append current x 1 buf append buf append current y 1 buf append buf append current x 0 buf append buf append current y 0 path is close path size 1 previou path get path size 1 current path get 0 previou mask bezi path c2 m a s k 0 current mask bezi path c1 m a s k 0 buf append l buf append current x 0 buf append buf append current y 0 buf append q buf append current x 1 buf append buf append current y 1 buf append buf append current x 0 buf append buf append current y 0 current mask bezi path c1 m a s k 0 buf append q buf append previou x 2 buf append buf append previou y 2 buf append buf append current x 0 buf append buf append current y 0 buf append c buf append previou x 2 buf append buf append previou y 2 buf append buf append current x 1 buf append buf append current y 1 buf append buf append current x 0 buf append buf append current y 0 buf append z buf to hash set path command hash set array a list m m z z l l h h v v c c s s q q t t list bezi path from path data str i o link list bezi path path link list bezi path bezi path path point2 d p point2 d point2 d c1 point2 d point2 d c2 point2 d stream tokeniz tt stream tokeniz reader str tt reset syntax tt parse number tt whitespace char 0 tt whitespace char next command m command m tt next token stream tokeniz t t e o f tt ttype 0 command tt ttype command next command tt push back bezi path node node command moveto m path path add path path bezi path tt next token stream tokeniz t t n u m b e r i o number expect p x tt nval tt next token stream tokeniz t t n u m b e r i o number expect p y tt nval path move to p x p y next command l m path path add path path bezi path tt next token stream tokeniz t t n u m b e r i o number expect p x + tt nval tt next token stream tokeniz t t n u m b e r i o number expect p y + tt nval path move to p x p y next command l close path z z p x path get 0 x 0 p y path get 0 y 0 path set close lineto l tt next token stream tokeniz t t n u m b e r i o number expect p x tt nval tt next token stream tokeniz t t n u m b e r i o number expect p y tt nval path line to p x p y next command l l tt next token stream tokeniz t t n u m b e r i o number expect p x + tt nval tt next token stream tokeniz t t n u m b e r i o number expect p y + tt nval path line to p x p y next command l h tt next token stream tokeniz t t n u m b e r i o number expect p x tt nval path line to p x p y next command h h tt next token stream tokeniz t t n u m b e r i o number expect p x + tt nval path line to p x p y next command h v tt next token stream tokeniz t t n u m b e r i o number expect p y tt nval path line to p x p y next command v v tt next token stream tokeniz t t n u m b e r i o number expect p y + tt nval path line to p x p y next command v curveto c tt next token stream tokeniz t t n u m b e r i o number expect c1 x tt nval tt next token stream tokeniz t t n u m b e r i o number expect c1 y tt nval tt next token stream tokeniz t t n u m b e r i o number expect c2 x tt nval tt next token stream tokeniz t t n u m b e r i o number expect c2 y tt nval tt next token stream tokeniz t t n u m b e r i o number expect p x tt nval tt next token stream tokeniz t t n u m b e r i o number expect p y tt nval path curve to c1 x c1 y c2 x c2 y p x p y next command c c tt next token stream tokeniz t t n u m b e r i o number expect c1 x p x + tt nval tt next token stream tokeniz t t n u m b e r i o number expect c1 y p y + tt nval tt next token stream tokeniz t t n u m b e r i o number expect c2 x p x + tt nval tt next token stream tokeniz t t n u m b e r i o number expect c2 y p y + tt nval tt next token stream tokeniz t t n u m b e r i o number expect p x + tt nval tt next token stream tokeniz t t n u m b e r i o number expect p y + tt nval path curve to c1 x c1 y c2 x c2 y p x p y next command c s node path get path size 1 c1 x node x 0 2d node x 1 c1 y node y 0 2d node y 1 tt next token stream tokeniz t t n u m b e r i o number expect c2 x tt nval tt next token stream tokeniz t t n u m b e r i o number expect c2 y tt nval tt next token stream tokeniz t t n u m b e r i o number expect p x tt nval tt next token stream tokeniz t t n u m b e r i o number expect p y tt nval path curve to c1 x c1 y c2 x c2 y p x p y next command s s node path get path size 1 c1 x node x 0 2d node x 1 c1 y node y 0 2d node y 1 tt next token stream tokeniz t t n u m b e r i o number expect c2 x p x + tt nval tt next token stream tokeniz t t n u m b e r i o number expect c2 y p y + tt nval tt next token stream tokeniz t t n u m b e r i o number expect p x + tt nval tt next token stream tokeniz t t n u m b e r i o number expect p y + tt nval path curve to c1 x c1 y c2 x c2 y p x p y next command s quadto q tt next token stream tokeniz t t n u m b e r i o number expect c1 x tt nval tt next token stream tokeniz t t n u m b e r i o number expect c1 y tt nval tt next token stream tokeniz t t n u m b e r i o number expect p x tt nval tt next token stream tokeniz t t n u m b e r i o number expect p y tt nval path quad to c1 x c1 y p x p y next command q q tt next token stream tokeniz t t n u m b e r i o number expect c1 x p x + tt nval tt next token stream tokeniz t t n u m b e r i o number expect c1 y p y + tt nval tt next token stream tokeniz t t n u m b e r i o number expect p x + tt nval tt next token stream tokeniz t t n u m b e r i o number expect p y + tt nval path quad to c1 x c1 y p x p y next command q t node path get path size 1 c1 x node x 0 2d node x 1 c1 y node y 0 2d node y 1 tt next token stream tokeniz t t n u m b e r i o number expect p x tt nval tt next token stream tokeniz t t n u m b e r i o number expect p y tt nval path quad to c1 x c1 y p x p y next command t t node path get path size 1 c1 x node x 0 2d node x 1 c1 y node y 0 2d node y 1 tt next token stream tokeniz t t n u m b e r i o number expect p x + tt nval tt next token stream tokeniz t t n u m b e r i o number expect p y + tt nval path quad to c1 x c1 y p x p y next command s i o illegal command +command path path add path path get inherit attribute name dom input in list map style list value in get inherit attribute name i value size 1 i 0 i value get i value get i style get i style get i contain key name style get i get name read the attribute from the specify dom input and assign them to the figure read attribute figure f dom input in i o f i x m e is not working when style and individual attribute are both use in an s v g document list map style list map list value in get inherit attribute style v value style add get style v value fill color value get inherit attribute fill in style value color color get color value color i n h e r i t c o l o r color c u r r e n t c o l o r f i l l c o l o r set f color value get inherit attribute fill rule in style value w i n d i n g r u l e set f value to upper equal n o n z e r o ? winding rule n o n z e r o winding rule e v e n o d d w i n d i n g r u l e set f winding rule n o n z e r o stroke color value get inherit attribute stroke in style value color color get color value color i n h e r i t c o l o r color c u r r e n t c o l o r s t r o k e c o l o r set f color value get inherit attribute stroke width in style value s t r o k e w t h set f value of value value get inherit attribute stroke miterlimit in style value s t r o k e m i t e r l i m i t f a c t o r set f value of value value get inherit attribute stroke dasharray in style value tokeniz tt tokeniz value dash tt count token i 0 n dash length i n i++ dash i value of tt next token s t r o k e d a s h e s set f dash value get inherit attribute stroke dashoffset in style value s t r o k e d a s h p h a s e set f math ab value of value value get inherit attribute font size in style value f o n t s i z e set f get dimension value in value value get inherit attribute text anchor in style value s v g text t e x t a n c h o r set f value of s v g text text anchor value to upper map get style str i o hash map style hash map str style stream tokeniz tt stream tokeniz reader str tt reset syntax tt word char 9 tt word char tt word char 128 + 32 255 tt whitespace char 0 tt next token stream tokeniz t t e o f tt ttype key value tt ttype stream tokeniz t t w o r d i o key token expect in +str+ + to hex tt ttype key tt sval tt next token i o colon expect after +key+ in +str tt next token stream tokeniz t t w o r d i o value token expect after +key+ in +str+ +tt ttype value tt sval tt next token stream tokeniz t t w o r d value + + tt sval tt push back style put key value style color get color value value value trim to lower value equal none value equal current color indicate that painting shall be do using the color specify by the color property c u r r e n t c o l o r value equal inherit each property may also have a specify value of inherit which mean that a given element the property take the same compute value a the property the element s parent i n h e r i t c o l o r s v g c o l o r s contain key value s v g c o l o r s get value value start with # value length 7 color decode value value start with # value length 4 three digit hex value th decode value color th 0xf | th 0xf 4 | th 0xf0 4 | th 0xf0 8 | th 0xf00 8 | th 0xf00 12 value start with rgb tokeniz tt tokeniz value tt next token color c color decode tt next token decode tt next token decode tt next token c set default figure f set s v g value f i l l c o l o r set f color black s t r o k e c o l o r set f s t r o k e d a s h f a c t o r set f 1d write the attribute of the figure into the specify dom output write attribute figure f dom output out i o color color dbl value fill attribute color f i l l c o l o r get f color value none value 000000 + to hex color get r g b value # +value substring value length 6 out add attribute fill value w i n d i n g r u l e get f winding rule n o n z e r o out add attribute fill rule evenodd stroke attribute color s t r o k e c o l o r get f color value none value 000000 + to hex color get r g b value # +value substring value length 6 out add attribute stroke value out add attribute stroke width s t r o k e w t h get f 1d out add attribute stroke miterlimit s t r o k e m i t e r l i m i t f a c t o r get f s t r o k e w t h get f 4d dash s t r o k e d a s h e s get f dbl s t r o k e d a s h f a c t o r get f ? s t r o k e w t h get f s t r o k e d a s h f a c t o r get f dash builder buf builder i 0 i dash length i++ i 0 buf append buf append dash i dbl out add attribute stroke dasharray buf to out add attribute stroke dashoffset s t r o k e d a s h p h a s e get f 0d text attribute out add attribute font size f o n t s i z e get f out add attribute text anchor start 